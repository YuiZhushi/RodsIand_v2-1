<head>
  <script type="module">
    var a = {
      286() {
        $(() => {
          const a = "阿克柰子mini",
            e = { "\x3c!--西幻开局--\x3e": "西幻世界" };
          let t = !1,
            s = !1;
          async function n(e, t) {
            getWorldbookNames().includes(a) &&
              (await updateWorldbookWith(
                a,
                (a) =>
                  a.map((a) =>
                    a.name === e
                      ? {
                        ...a,
                        enabled: t,
                        strategy: {
                          ...a.strategy,
                          type: t ? "constant" : "selective",
                        },
                      }
                      : a
                  ),
                { render: "immediate" }
              ));
          }
          async function d() {
            const a = (function () {
              const a = getChatMessages(0);
              if (0 === a.length) return null;
              const t = a.find((a) => "assistant" === a.role);
              if (!t) return null;
              const s = t.message || "";
              for (const [a, t] of Object.entries(e))
                if (s.includes(a)) return t;
              return null;
            })();
            for (const [, t] of Object.entries(e)) await n(t, a === t);
            s = !0;
          }
          eventOn(tavern_events.MESSAGE_SENT, async () => {
            s ||
              setTimeout(async () => {
                const a = getChatMessages(0).find(
                  (a) => "assistant" === a.role
                ),
                  e = getChatMessages(-1).find((a) => "user" === a.role);
                a && e && ((t = !0), await d(), (t = !1));
              }, 200);
          }),
            eventOn(
              tavern_events.GENERATE_BEFORE_COMBINE_PROMPTS,
              async () => {
                t && (await d(), (t = !1));
              }
            );
        });
      },
    },
      e = {};
    function t(s) {
      var n = e[s];
      if (void 0 !== n) return n.exports;
      var d = (e[s] = { exports: {} });
      return a[s](d, d.exports, t), d.exports;
    }
    (t.n = (a) => {
      var e = a && a.__esModule ? () => a.default : () => a;
      return t.d(e, { a: e }), e;
    }),
      (t.d = (a, e) => {
        for (var s in e)
          t.o(e, s) &&
            !t.o(a, s) &&
            Object.defineProperty(a, s, { enumerable: !0, get: e[s] });
      }),
      (t.o = (a, e) => Object.prototype.hasOwnProperty.call(a, e));
    const s = _;
    var n = t.n(s);
    const d = [
      {
        name: "简单",
        armorValue: 0,
        description: "轻松的性爱体验，无需复杂的战术博弈。",
        enemyFeatures: [
          "干员处于潜意识的最表层，她们保留着原作的性格，但心智松懈。",
        ],
        experienceFocus: "轻松的性爱体验，无需复杂的战术博弈。",
        color: "#10b981",
      },
      {
        name: "普通",
        armorValue: 50,
        description: "标准的罗德岛干员状态，保留着原作的性格。",
        enemyFeatures: [
          "标准的罗德岛干员状态，保留着原作的性格。",
          "干员的心智相对放松，认为自己是自然的生活在这个世界中。",
          "具备正常的战术素养，会组织进攻与反击。",
        ],
        experienceFocus: "需要基本的资源管理和战术规划。",
        color: "#0ea5e9",
      },
      {
        name: "困难",
        armorValue: 70,
        description:
          "干员处于罗德岛的战时状态，保留原作性格的基础上相对谨慎和警惕。",
        enemyFeatures: [
          "干员处于罗德岛的战时状态，保留原作性格的基础上相对谨慎和警惕。",
          "在拥有理智护甲时，意志坚定，对普通的性骚扰具有耐受力。",
          "具备良好的战术素养，会组织进攻反击，设计圈套与策略运用。",
        ],
        experienceFocus: "需要有效的资源管理和战术规划才能战胜对手。",
        color: "#f59e0b",
      },
      {
        name: "极难",
        armorValue: 100,
        description: "这是一个冷酷、真实、没有任何情色滤镜的泰拉世界。",
        enemyFeatures: [
          "这是一个冷酷、真实、没有任何情色滤镜的泰拉世界。",
          "所有的物理法则和人际关系都严格遵循原作设定。",
          "这里的干员拥有最为完整的灵魂和独立的人格。",
          '她们对"性"持有符合其身份的保守或排斥态度。在拥有理智护甲时对性骚扰有极高的耐受力。',
          "所有干员处于战时状态，会通过各种战术策略与战斗方式来消灭林楓，每个干员都会全力以赴。",
        ],
        experienceFocus:
          "挑战极限，林楓不可能全身而退，需要极高的资源管理能力，随机应变能力和策略才能获得胜利。",
        color: "#ef4444",
      },
    ];
    let i = null,
      l = null,
      o = null,
      c = null,
      r = 0;
    function p() {
      try {
        const t = { type: "message", message_id: "latest" },
          s = Mvu.getMvuData(t);
        if (s?.stat_data) {
          return (
            ((a = n().get(s.stat_data, "玩家数据.难度等级")),
              (e = ""),
              Array.isArray(a) && a.length > 0 ? a[0] : a ?? e) || "无"
          );
        }
      } catch (a) {
        console.warn("Failed to get selected difficulty:", a);
      }
      var a, e;
      return "无";
    }
    function u(a) {
      (c = a), g();
    }
    function f() {
      o && (r = o.scrollTop), (c = null), g(), o && (o.scrollTop = r);
    }
    async function v() {
      const a = l ? l.name : "普通",
        e = '<span style="display: none;">开始作战</span>',
        t = { type: "message", message_id: "latest" };
      try {
        const e = Mvu.getMvuData(t);
        e &&
          (n().set(e, "stat_data.玩家数据.难度等级", a),
            await Mvu.replaceMvuData(e, t));
      } catch (a) {
        console.warn("Failed to save difficulty selection:", a);
      }
      if (triggerSlash) triggerSlash(`/setinput ${e}|`);
      else {
        const a = $("#send_textarea");
        a.val(e),
          a.trigger("input"),
          a[0].dispatchEvent(
            new KeyboardEvent("keydown", { key: "Enter", bubbles: !0 })
          );
      }
      o && (o.innerHTML = "");
    }
    function g() {
      if (!o) return;
      const a = o.scrollTop,
        e = $("<div>").addClass("difficulty-selector-root"),
        t = $("<div>").addClass("difficulty-title-section");
      t.append(
        $("<div>").addClass("difficulty-main-title").text("选择难度等级")
      ),
        t.append(
          $("<div>")
            .addClass("difficulty-subtitle")
            .text("不同难度会影响敌人的理智护甲值和战斗强度")
        ),
        e.append(t);
      const s = $("<div>").addClass("difficulty-grid");
      d.forEach((a) => {
        const e = l?.name === a.name,
          t = i?.name === a.name,
          n = $("<div>")
            .addClass("difficulty-card")
            .toggleClass("selected", t)
            .toggleClass("confirmed", e)
            .css("--difficulty-color", a.color);
        e ||
          n.on("click", (e) => {
            e.stopPropagation(), u(a);
          });
        const d = $("<div>").addClass("difficulty-card-header");
        d.append($("<div>").addClass("difficulty-card-name").text(a.name)),
          d.append(
            $("<div>")
              .addClass("difficulty-card-armor")
              .text(`理智护甲: ${a.armorValue}`)
          );
        const o = $("<div>").addClass("difficulty-card-body");
        o.append(
          $("<div>").addClass("difficulty-card-desc").text(a.description)
        );
        const c = $("<div>").addClass("difficulty-card-footer");
        if (e) {
          const e = $("<div>")
            .addClass("difficulty-confirmed-badge")
            .text("已确认")
            .css("--difficulty-color", a.color)
            .css(
              "--difficulty-color-rgb",
              (() => {
                const e = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(
                  a.color
                );
                return e
                  ? `${parseInt(e[1], 16)}, ${parseInt(e[2], 16)}, ${parseInt(
                    e[3],
                    16
                  )}`
                  : "14, 165, 233";
              })()
            );
          c.append(e);
        } else
          c.append(
            $("<button>")
              .addClass("difficulty-detail-btn")
              .text("查看详情")
              .on("click", (e) => {
                e.stopPropagation(), e.preventDefault(), u(a);
              })
          );
        n.append(d).append(o).append(c), s.append(n);
      }),
        e.append(s);
      const n = $("<div>").addClass("difficulty-action-section");
      if (l) {
        const a = (a) => {
          const e = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);
          return e
            ? `${parseInt(e[1], 16)}, ${parseInt(e[2], 16)}, ${parseInt(
              e[3],
              16
            )}`
            : "14, 165, 233";
        },
          e = $("<div>")
            .addClass("difficulty-confirmed-info")
            .css("--difficulty-color", l.color)
            .css("--difficulty-color-rgb", a(l.color));
        e.html(
          `<div class="difficulty-confirmed-label">已选择难度</div><div class="difficulty-confirmed-name">${l.name}</div>`
        ),
          n.append(e);
      }
      if (
        (n.append(
          $("<button>")
            .addClass("difficulty-start-btn")
            .text("开始作战")
            .on("click", v)
        ),
          e.append(n),
          c)
      ) {
        const a = $("<div>").addClass("difficulty-dialog-mask").on("click", f),
          t = (a) => {
            const e = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);
            return e
              ? `${parseInt(e[1], 16)}, ${parseInt(e[2], 16)}, ${parseInt(
                e[3],
                16
              )}`
              : "14, 165, 233";
          },
          s = $("<div>")
            .addClass("difficulty-dialog")
            .css("--difficulty-color", c.color)
            .css("--difficulty-color-rgb", t(c.color))
            .on("click", (a) => a.stopPropagation()),
          n = $("<div>").addClass("difficulty-dialog-header");
        n.append($("<div>").addClass("difficulty-dialog-title").text(c.name)),
          n.append(
            $("<div>")
              .addClass("difficulty-dialog-armor")
              .text(`理智护甲: ${c.armorValue}`)
          ),
          n.append(
            $("<button>")
              .addClass("difficulty-dialog-close")
              .text("×")
              .on("click", f)
          );
        const d = $("<div>").addClass("difficulty-dialog-body");
        d.append(
          $("<div>").addClass("difficulty-dialog-desc").text(c.description)
        );
        const o = $("<div>")
          .addClass("difficulty-features-title")
          .text("敌人特征：");
        d.append(o);
        const r = $("<div>").addClass("difficulty-features-list");
        c.enemyFeatures.forEach((a) => {
          r.append(
            $("<div>").addClass("difficulty-feature-item").text(`• ${a}`)
          );
        }),
          d.append(r);
        const p = $("<div>")
          .addClass("difficulty-experience-title")
          .text("体验：");
        d.append(p),
          d.append(
            $("<div>")
              .addClass("difficulty-experience-text")
              .text(c.experienceFocus)
          );
        const u = $("<div>").addClass("difficulty-dialog-actions");
        u.append(
          $("<button>")
            .addClass("difficulty-dialog-cancel-btn")
            .text("取消")
            .on("click", f)
        ),
          u.append(
            $("<button>")
              .addClass("difficulty-dialog-confirm-btn")
              .text("确认选择")
              .on("click", () => {
                c && ((i = c), i && ((l = i), f(), g()));
              })
          ),
          d.append(u),
          s.append(n).append(d),
          a.append(s),
          e.append(a);
      }
      (o.innerHTML = ""),
        o.appendChild(e[0]),
        r > 0 ? (o.scrollTop = r) : a > 0 && (o.scrollTop = a);
    }
    $(() => {
      (o = document.getElementById("difficulty-selector")),
        o &&
        (o && (o.innerHTML = ""),
          (async () => {
            await waitGlobalInitialized("Mvu"),
              window.addEventListener("showDifficultySelector", () => {
                const a = p();
                a && "无" !== a ? o && (o.innerHTML = "") : g();
              });
            const a = p();
            a && "无" !== a && o && (o.innerHTML = "");
          })());
    });
    let m = [],
      C = !1, //默認收起
      selectedOptions = [],
      b = null;
    function y() {
      const a = (function () {
        const a = getChatMessages(-1, { role: "assistant" });
        if (!a?.length) return [];
        const e = a[0].message.match(
          new RegExp("<game_options>(.*?)</game_options>", "s")
        );
        if (!e) return [];
        const t = e[1].trim();
        if (!t) return [];
        const s = [];
        return (
          t
            .split("\n")
            .filter((a) => a.trim())
            .forEach((a, e) => {
              const t = a.trim();
              if (!t) return;
              const n = t.match(
                new RegExp('<span style="display: none;">(.*?)</span>', "s")
              ),
                d = n ? n[1].trim() : "";
              let i = t
                .replace(
                  new RegExp('<span style="display: none;">.*?</span>', "gs"),
                  ""
                )
                .trim();
              const l = i.match(/^(?:选项\s*\d+|[\d.]+)[:：]\s*(.+)$/);
              l && (i = l[1].trim()),
                i && s.push({ id: `option${e + 1}`, text: i, hiddenResult: d });
            }),
          s
        );
      })();
      // (m = a), a.length > 0 && (C = !0), E(); //取消自動展開
      (m = a), (selectedOptions = []), E();
    }
    function h() {
      (C = !C), E();
    }
    function x(a) {
      const t = selectedOptions.findIndex((e) => e.id === a.id);
      -1 !== t ? selectedOptions.splice(t, 1) : selectedOptions.push(a);
      let e = "";
      if (selectedOptions.length > 0) {
        e = `我选择了：${selectedOptions.map((a) => a.text).join("，")}`;
        const s = selectedOptions
          .map((a) => a.hiddenResult)
          .filter(Boolean)
          .join("");
        s && (e += `<span style="display: none;">${s}</span>`);
      }
        (function (a) {
          const e = window.parent.document.querySelector("#send_textarea");
          e
            ? ((e.value = a),
              e.dispatchEvent(new Event("input", { bubbles: !0 })),
              e.focus())
            : console.error("[选项] 未找到聊天输入框");
        })(e),
        E();
    }
    function E() {
      if (!b) return;
      if (0 === m.length) return void (b.innerHTML = "");
      const a = $("<div>").addClass("options-root"),
        e = $("<div>").addClass("options-panel"),
        t = $("<div>").addClass("panel-header").on("click", h),
        s = $("<div>").addClass("panel-header-content");
      s.append($("<div>").addClass("panel-title").text("选择行动")),
        C || s.append($("<div>").addClass("panel-sub").text("点击展开选项"));
      const n = $("<div>").addClass("expand-icon").text("▼");
      if ((C && n.addClass("expanded"), t.append(s).append(n), C)) {
        const a = $("<div>").addClass("options-grid");
        m.forEach((e, t) => {
          const s = $("<button>")
            .addClass("option-btn")
            .toggleClass(
              "selected",
              selectedOptions.some((t) => t.id === e.id)
            )
            .on("click", () => x(e));
          s.append($("<div>").addClass("option-text").text(e.text)),
            a.append(s);
        }),
          e.append(t).append(a);
      } else e.append(t);
      a.append(e), (b.innerHTML = ""), b.appendChild(a[0]);
    }
    function M(a, e) {
      return Array.isArray(a) && a.length > 0 ? a[0] : a ?? e;
    }
    $(() => {
      if (((b = document.getElementById("options-app")), !b)) return;
      if (!document.getElementById("multi-select-style")) {
        $("head").append(
          `<style id="multi-select-style">.option-btn.selected { border-color: #22d3ee; background: rgba(34, 211, 238, 0.2); color: #22d3ee; }</style>`
        );
      }
      y();
      let a = null;
      const e = () => {
        a && clearTimeout(a),
          (a = setTimeout(() => {
            y();
          }, 150));
      };
      eventOn &&
        tavern_events &&
        (eventOn(tavern_events.MESSAGE_RECEIVED, e),
          eventOn(tavern_events.GENERATION_ENDED, e));
      const t = window.Mvu;
      eventOn &&
        t?.events?.VARIABLE_UPDATE_ENDED &&
        eventOn(t.events.VARIABLE_UPDATE_ENDED, e);
    });
    let w = { demonShackles: !1, layer5Intro: !1, finalBoss: !1 };
    function k() {
      try {
        const a = { type: "message", message_id: "latest" },
          e = Mvu.getMvuData(a);
        if (e?.stat_data) {
          const a = M(n().get(e.stat_data, "玩家数据.持有藏品"), []);
          if (Array.isArray(a))
            return a.some((a) => {
              if (a && "object" == typeof a) {
                const e = M(a["名称"] || "", "");
                return String(e).includes("魔王的镣铐");
              }
              return !1;
            });
        }
      } catch (a) {
        console.warn("Failed to check demon shackles:", a);
      }
      return !1;
    }
    async function D(a, e) {
      try {
        SillyTavern?.setExtensionPrompt
          ? (await SillyTavern.setExtensionPrompt(a, e, 1, 0, !1, 0),
            console.info(`[特殊事件] 已通过extension prompt注入提示词: ${a}`))
          : console.warn("[特殊事件] SillyTavern.setExtensionPrompt 不可用");
      } catch (a) {
        console.error("[特殊事件] 注入提示词失败:", a);
      }
    }
    async function A() {
      try {
        const a = { type: "message", message_id: "latest" },
          e = Mvu.getMvuData(a);
        if (!e?.stat_data)
          return void console.debug("[特殊事件] 无法获取stat_data");
        const t = Number(M(n().get(e.stat_data, "探索进度.当前层数"), 0)),
          s = Number(M(n().get(e.stat_data, "探索进度.当前关卡"), 0));
        if (
          (console.debug(`[特殊事件] 当前位置: 第${t}层 第${s}节点`),
            console.debug("[特殊事件] 触发状态:", w),
            !w.demonShackles && 3 === t && 7 === s)
        ) {
          console.info("[特殊事件] 检测到第3层第7节点，准备发送魔王的镣铐提示");
          const a =
            "【特殊藏品出现】\n第3层【险路恶敌】（BOSS战）战斗胜利后，除了战斗正常获得的藏品之外，还在战利品中发现了一个散发着不祥气息的独特藏品：\n\n【魔王的镣铐】\n描述：散发着不祥气息的光环\n效果：所有敌方干员的【理智护甲】上限提升 30%，游戏走向新的结局\n\n**重要指示**：\n1. 在战斗胜利的描述中，明确提到发现了这个特殊藏品\n2. 必须在回复末尾生成选项，让林楓选择拾取哪个藏品\n3. 如果林楓选择拾取【魔王的镣铐】，才使用变量更新命令添加到藏品列表：\n   _.insert('玩家数据.持有藏品', {名称:'魔王的镣铐', 描述:'散发着不祥气息的光环'});\n4. 如果林楓选择拾取其他藏品或离开，则不添加【魔王的镣铐】到藏品列表中\n5. 注意：藏品数据格式必须是 {名称:'...', 描述:'...'}，不要使用\"效果\"字段\n\n选项示例：\n<game_options>\n选项1: 拾取【魔王的镣铐】\n选项2: 拾取另一个藏品（战斗正常获得的藏品）\n选项3: 离开\n</game_options>";
          await D("special_event_demon_shackles", a),
            (w.demonShackles = !0),
            console.info("[特殊事件] ✓ 已触发：魔王的镣铐");
        }
        if (!w.layer5Intro && 5 === t && 1 === s && k()) {
          console.info("[特殊事件] 检测到第5层第1节点且拥有魔王的镣铐");
          const a =
            "BOSS档案（出现在第五层第七节点）：\n  名称: 文明的枷锁·阿米娅 (Civilight Eterna)\n  称号: 魔王 / 众魂的容器\n\n  身份:\n    - 萨卡兹的君主，魔王力量的完全解放形态。\n    - 泰拉文明理智、道德与责任的终极具象化。\n\n  视觉形象 (参考魔王形态):\n    - 服装: 身着一袭漆黑的、由某种高分子材料编织而成的华丽长裙礼服。礼服的设计充满了禁欲感，领口紧束至下巴，长袖末端被多重黑色的皮带死死勒住，象征着对自身的绝对约束。\n    - 头饰: 头顶佩戴着一顶由黑色源石晶体构成的尖刺王冠，那些晶体仿佛是直接从她的头骨中生长出来的，带着一种残酷的美感。\n    - 武器: 手持一把巨大的黑色长剑【影霄】，剑身周围缭绕着黑色的气息，那是历代魔王的悲愿。\n    - 氛围: 她身后悬浮着巨大的黑色菱形晶体光环，表情不再是平日的温和，而是如神像般冰冷、悲悯且不可侵犯。";
          await D("special_event_layer5_intro", a),
            (w.layer5Intro = !0),
            console.info("[特殊事件] ✓ 已触发：第5层序章");
        }
        if (!w.finalBoss && 5 === t && 7 === s && k()) {
          console.info("[特殊事件] 检测到第5层第7节点且拥有魔王的镣铐");
          const a =
            "BOSS档案（出现在第五层第七节点）：\n  名称: 文明的枷锁·阿米娅 (Civilight Eterna)\n  称号: 魔王 / 众魂的容器\n\n  身份:\n    - 萨卡兹的君主，魔王力量的完全解放形态。\n    - 泰拉文明理智、道德与责任的终极具象化。\n\n  视觉形象 (参考魔王形态):\n    - 服装: 身着一袭漆黑的、由某种高分子材料编织而成的华丽长裙礼服。礼服的设计充满了禁欲感，领口紧束至下巴，长袖末端被多重黑色的皮带死死勒住，象征着对自身的绝对约束。\n    - 头饰: 头顶佩戴着一顶由黑色源石晶体构成的尖刺王冠，那些晶体仿佛是直接从她的头骨中生长出来的，带着一种残酷的美感。\n    - 武器: 手持一把巨大的黑色长剑【影霄】，剑身周围缭绕着黑色的气息，那是历代魔王的悲愿。\n    - 氛围: 她身后悬浮着巨大的黑色菱形晶体光环，表情不再是平日的温和，而是如神像般冰冷、悲悯且不可侵犯。";
          await D("special_event_final_boss", a),
            (w.finalBoss = !0),
            console.info("[特殊事件] ✓ 已触发：最终BOSS战");
        }
      } catch (a) {
        console.error("[特殊事件] 检查事件时出错:", a);
      }
    }
    $(() => {
      (async () => {
        console.info("[特殊事件触发器] 开始初始化..."),
          await waitGlobalInitialized("Mvu"),
          console.info("[特殊事件触发器] Mvu已就绪"),
          console.info("[特殊事件触发器] 执行初始检查"),
          A(),
          eventOn && Mvu?.events?.VARIABLE_UPDATE_ENDED
            ? (eventOn(Mvu.events.VARIABLE_UPDATE_ENDED, () => {
              console.debug("[特殊事件触发器] 检测到变量更新事件"), A();
            }),
              console.info("[特殊事件触发器] 已注册变量更新监听器"))
            : console.warn("[特殊事件触发器] 无法注册变量更新监听器"),
          eventOn && tavern_events?.MESSAGE_RECEIVED
            ? (eventOn(tavern_events.MESSAGE_RECEIVED, () => {
              console.debug("[特殊事件触发器] 检测到消息接收事件"),
                setTimeout(() => {
                  A();
                }, 100);
            }),
              console.info("[特殊事件触发器] 已注册消息接收监听器"))
            : console.warn("[特殊事件触发器] 无法注册消息接收监听器"),
          console.info("[特殊事件触发器] ✓ 初始化完成");
      })();
    });
    const N = [
      {
        name: "指挥分队",
        description:
          "以指挥和掌控为核心的分队，擅长通过精神吸取恢复体力，并通过母畜干员的性服务获得正面反馈。",
        benefits: [
          "每次战斗结束后，自动对战败干员进行一次精神吸取，恢复 15 点体力值。",
          "部署位的母畜干员在进行性服务时，提供的正面反馈效果提升。",
        ],
        color: "#0ea5e9",
      },
      {
        name: "矛头分队",
        description:
          "以高风险高回报为特点的分队，通过降低自身体力值换取更高的伤害输出和敌方敏感度提升。",
        benefits: [
          "林楓的【体力值】初始降为15点",
          "所有性行为造成的【堕落值】伤害翻倍",
          "敌方干员的敏感度被强行提升，更容易高潮瘫痪或连续高潮",
        ],
        color: "#ef4444",
      },
      {
        name: "心胜于物分队",
        description:
          "专注于收集和利用藏品的分队，所有藏品都会触发特殊的色情效果，商店更容易刷新稀有藏品。",
        benefits: [
          "每次战斗胜利后，必定额外获得一个随机【藏品】。",
          "所有【藏品】不只是提升属性和作战能力，还会触发的特殊色情效果。",
          "商店中出售【藏品】更容易刷新出带有色情和调教的稀有藏品。",
        ],
        color: "#a855f7",
      },
      {
        name: "永恒狩猎分队",
        description:
          "专注于资源获取的分队，战斗持续时间越长，获得的奖励越多，捕获的干员也会更加堕落。",
        benefits: [
          "战斗胜利后获得的【淫欲值】和【精液配给】奖励翻倍",
          "战斗的持续时间越长，获得的奖励就越多",
          "每次战斗胜利，战斗的持续时间越长，战斗越艰难，捕获的干员就会更加堕落",
        ],
        color: "#f59e0b",
      },
      {
        name: "异想天开分队",
        description:
          "以随机性和极端效果为特点的分队，每层都会获得随机的世界性癖词条，不期而遇事件效果大幅增强。",
        benefits: [
          "进入每一层新区域时，随机获得一个持续整层的【世界性癖词条】",
          "【不期而遇】节点遇到的事件效果大幅增强",
        ],
        color: "#22d3ee",
      },
    ];
    let S = null,
      q = null,
      T = null,
      I = null,
      O = 0;
    function R() {
      try {
        const t = { type: "message", message_id: "latest" },
          s = Mvu.getMvuData(t);
        if (s?.stat_data) {
          return (
            ((a = n().get(s.stat_data, "玩家数据.选择分队")),
              (e = ""),
              Array.isArray(a) && a.length > 0 ? a[0] : a ?? e) || "无"
          );
        }
      } catch (a) {
        console.warn("Failed to get selected squad:", a);
      }
      var a, e;
      return "无";
    }
    function P(a) {
      (I = a), V();
    }
    function B() {
      T && (O = T.scrollTop), (I = null), V(), T && (T.scrollTop = O);
    }
    async function F() {
      if (!q) return;
      const a = q.name,
        e = { type: "message", message_id: "latest" };
      try {
        const t = Mvu.getMvuData(e);
        t &&
          (n().set(t, "stat_data.玩家数据.选择分队", a),
            await Mvu.replaceMvuData(t, e));
      } catch (a) {
        console.warn("Failed to save squad selection:", a);
      }
      T && (T.innerHTML = "");
      document.getElementById("difficulty-selector") &&
        window.dispatchEvent(new CustomEvent("showDifficultySelector"));
    }
    function V() {
      if (!T) return;
      const a = T.scrollTop,
        e = $("<div>").addClass("squad-selector-root"),
        t = $("<div>").addClass("squad-title-section");
      t.append($("<div>").addClass("squad-main-title").text("选择你的分队")),
        t.append(
          $("<div>")
            .addClass("squad-subtitle")
            .text("每个分队都有独特的游戏机制和玩法风格")
        ),
        e.append(t);
      const s = $("<div>").addClass("squad-grid");
      N.forEach((a) => {
        const e = q?.name === a.name,
          t = S?.name === a.name,
          n = $("<div>")
            .addClass("squad-card")
            .toggleClass("selected", t)
            .toggleClass("confirmed", e)
            .css("--squad-color", a.color);
        e ||
          n.on("click", (e) => {
            e.stopPropagation(), P(a);
          });
        const d = $("<div>").addClass("squad-card-header");
        d.append($("<div>").addClass("squad-card-name").text(a.name)),
          a.alias &&
          d.append($("<div>").addClass("squad-card-alias").text(a.alias));
        const i = $("<div>").addClass("squad-card-body");
        i.append($("<div>").addClass("squad-card-desc").text(a.description));
        const l = $("<div>").addClass("squad-card-footer");
        e
          ? l.append(
            $("<div>").addClass("squad-confirmed-badge").text("已确认")
          )
          : l.append(
            $("<button>")
              .addClass("squad-detail-btn")
              .text("查看详情")
              .on("click", (e) => {
                e.stopPropagation(), e.preventDefault(), P(a);
              })
          ),
          n.append(d).append(i).append(l),
          s.append(n);
      }),
        e.append(s);
      const n = $("<div>").addClass("squad-action-section");
      if (
        (q &&
          (n.append(
            $("<div>")
              .addClass("squad-confirmed-info")
              .html(
                `<div class="squad-confirmed-label">已选择分队</div><div class="squad-confirmed-name">${q.name}</div>`
              )
          ),
            n.append(
              $("<button>")
                .addClass("squad-start-btn")
                .text("确认并选择难度")
                .on("click", F)
            )),
          e.append(n),
          I)
      ) {
        const a = $("<div>").addClass("squad-dialog-mask").on("click", B),
          t = (a) => {
            const e = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);
            return e
              ? `${parseInt(e[1], 16)}, ${parseInt(e[2], 16)}, ${parseInt(
                e[3],
                16
              )}`
              : "34, 211, 238";
          },
          s = $("<div>")
            .addClass("squad-dialog")
            .css("--squad-color", I.color)
            .css("--squad-color-rgb", t(I.color))
            .on("click", (a) => a.stopPropagation()),
          n = $("<div>").addClass("squad-dialog-header");
        n.append($("<div>").addClass("squad-dialog-title").text(I.name)),
          n.append(
            $("<button>")
              .addClass("squad-dialog-close")
              .text("×")
              .on("click", B)
          );
        const d = $("<div>").addClass("squad-dialog-body");
        d.append($("<div>").addClass("squad-dialog-desc").text(I.description));
        const i = $("<div>")
          .addClass("squad-benefits-title")
          .text("初始增益：");
        d.append(i);
        const l = $("<div>").addClass("squad-benefits-list");
        I.benefits.forEach((a) => {
          const e = a.replace(/\([^)]*\)/g, "").trim();
          l.append($("<div>").addClass("squad-benefit-item").text(`• ${e}`));
        }),
          d.append(l);
        const o = $("<div>").addClass("squad-dialog-actions");
        o.append(
          $("<button>")
            .addClass("squad-dialog-cancel-btn")
            .text("取消")
            .on("click", B)
        ),
          o.append(
            $("<button>")
              .addClass("squad-dialog-confirm-btn")
              .text("确认选择")
              .on("click", () => {
                I && ((S = I), S && ((q = S), B(), V()));
              })
          ),
          d.append(o),
          s.append(n).append(d),
          a.append(s),
          e.append(a);
      }
      (T.innerHTML = ""),
        T.appendChild(e[0]),
        O > 0 ? (T.scrollTop = O) : a > 0 && (T.scrollTop = a);
    }
    $(() => {
      (T = document.getElementById("squad-selector")),
        T &&
        (async () => {
          await waitGlobalInitialized("Mvu");
          const a = R();
          a && "无" !== a ? T && (T.innerHTML = "") : V();
        })();
    });
    let L = null,
      G = !0,
      j = null,
      H = null,
      U = !1,
      isCollListExpanded = !0,
      isSkillsExpanded = !0,
      isCharStatusExpanded = !0,
      K = null,
      W = null,
      J = [];
    function Q(a, e) {
      return Array.isArray(a) && a.length > 0 ? a[0] : a ?? e;
    }
    function X(a) {
      if (!a) return "";
      const e = a.match(/【当前世界性癖词条[：:]\s*([^】]+)】/);
      if (e && e[1]) return e[1].trim();
      const t = a
        .split("\n")[0]
        .replace(/[*#【】]/g, "")
        .trim();
      return t.length <= 20 ? t : a.substring(0, 20) + "...";
    }
    function Y() {
      return L
        ? {
          hp: Number(Q(n().get(L.stat_data, "核心资源.体力值"), 0)),
          lust: Number(Q(n().get(L.stat_data, "核心资源.淫欲值"), 0)),
          semen: Number(Q(n().get(L.stat_data, "核心资源.精液配给"), 0)),
          layer: Number(Q(n().get(L.stat_data, "探索进度.当前层数"), 0)),
          stage: Number(Q(n().get(L.stat_data, "探索进度.当前关卡"), 0)),
          squad: String(Q(n().get(L.stat_data, "玩家数据.选择分队"), "无")),
          difficulty: String(
            Q(n().get(L.stat_data, "玩家数据.难度等级"), "无")
          ),
          fetishTerm: X(
            String(Q(n().get(L.stat_data, "玩家数据.当前层世界性癖词条"), ""))
          ),
        }
        : {
          hp: 0,
          lust: 0,
          semen: 0,
          layer: 0,
          stage: 0,
          squad: "无",
          difficulty: "无",
          fetishTerm: "",
        };
    }
    function Z(a) {
      return { 简单: 0, 普通: 50, 困难: 70, 极难: 100 }[a] || 0;
    }
    function aa(a) {
      return [
        "作战",
        "紧急作战",
        "险路恶敌",
        "不期而遇",
        "诡意行商",
        "安全屋",
        "闲暇娱乐",
        "得偿所愿",
      ].includes(a)
        ? a
        : "未知";
    }
    function ea() {
      (K = null), pa();
    }
    function ta() {
      if (!K) return;
      const a = K,
        e = aa(a.type),
        t = `<span style="display: none;">${`我选择了节点 ${a.nodeNumber}：${e}`}</span>`;
      if (triggerSlash) triggerSlash(`/setinput ${t}|`);
      else {
        const a = $("#send_textarea");
        a.val(t),
          a.trigger("input"),
          a[0].dispatchEvent(
            new KeyboardEvent("keydown", { key: "Enter", bubbles: !0 })
          );
      }
      ea();
    }
    function sa() {
      if (!H) return;
      if ("堕落" !== H.status) return;
      if (Y().lust < 6) return;
      const a = `我要晋升 ${H.name} 为母畜`;
      if (triggerSlash) triggerSlash(`/setinput ${a}|`);
      else {
        const e = $("#send_textarea");
        e.val(a),
          e.trigger("input"),
          e[0].dispatchEvent(
            new KeyboardEvent("keydown", { key: "Enter", bubbles: !0 })
          );
      }
      da();
    }
    function na() {
      (j = null), pa();
    }
    function da() {
      (H = null), pa();
    }
    function ia(a) {
      !(function (a) {
        const e = window.parent.document.querySelector("#send_textarea");
        e
          ? ((e.value = a),
            e.dispatchEvent(new Event("input", { bubbles: !0 })),
            e.focus())
          : console.error("[状态栏] 未找到聊天输入框");
      })(`使用${a}技能`);
    }
    function la() {
      if (0 === J.length) return;
      const a = `我要购买 ${J.join("、")}`;
      if (triggerSlash) triggerSlash(`/setinput ${a}|`);
      else {
        const e = $("#send_textarea");
        e.val(a),
          e.trigger("input"),
          e[0].dispatchEvent(
            new KeyboardEvent("keydown", { key: "Enter", bubbles: !0 })
          );
      }
      (J = []), pa();
    }
    function oa() {
      (J = []), pa();
    }
    function ca() {
      const a = getCurrentMessageId?.(),
        e = {
          type: "message",
          message_id: "number" == typeof a ? a : "latest",
        },
        t = Mvu.getMvuData(e);
      if (t?.stat_data) {
        L = Object.freeze(t);
        const a = (function () {
          if (!L) return "";
          const a = n().get(L.stat_data, "探索进度.当前层关卡列表") || [],
            e = Y().stage,
            t = a.find((a) => Number(a.节点编号 || a.nodeNumber || 0) === e);
          return (t && (t.类型 || t.type)) || "";
        })(),
          e = U && "诡意行商" === a;
        (U = "诡意行商" === a), !U && e && (J = []);
      }
      pa();
    }
    function ra() {
      const a = (function () {
        if (!L) return [];
        const a = n().get(L.stat_data, "探索进度.当前层关卡列表") || [],
          e = Y().stage,
          t = new Map();
        a.forEach((a) => {
          const s = Number(a.节点编号 || a.nodeNumber || 0);
          t.has(s) || t.set(s, []);
          const n = a.选项编号 || a.optionNumber,
            d = s === e + 1;
          t.get(s).push({
            nodeNumber: s,
            type: a.类型 || a.type || "",
            completed: Boolean(a.已完成 || a.completed),
            optionNumber: n ? Number(n) : void 0,
            combatData: a.作战资料 || a.combatData,
            canSelect: d,
          });
        });
        const s = [];
        return (
          Array.from(t.keys())
            .sort((a, e) => a - e)
            .forEach((a) => {
              const e = t.get(a);
              e.length > 0 &&
                (e.sort(
                  (a, e) => (a.optionNumber || 0) - (e.optionNumber || 0)
                ),
                  s.push({ nodeNumber: a, nodes: e }));
            }),
          s
        );
      })(),
        e = Y(),
        t = $("<div>").addClass("route-map");
      return (
        a.forEach((s, n) => {
          const d = $("<div>").addClass("route-node-group");
          s.nodes.forEach((a, t) => {
            const n = $("<div>")
              .addClass("route-node-wrapper")
              .toggleClass("has-options", s.nodes.length > 1)
              .toggleClass("current-node", a.nodeNumber === e.stage)
              .toggleClass("next-node", a.nodeNumber === e.stage + 1)
              .toggleClass("completed", a.completed)
              .toggleClass(
                "selectable",
                a.nodeNumber === e.stage + 1 && a.canSelect
              ),
              i = $("<div>")
                .addClass("route-node")
                .addClass(
                  ((l = a.type),
                    {
                      作战: "combat",
                      紧急作战: "urgent-combat",
                      险路恶敌: "boss",
                      不期而遇: "event",
                      诡意行商: "shop",
                      安全屋: "safehouse",
                      闲暇娱乐: "leisure",
                      得偿所愿: "reward",
                    }[l] || "unknown")
                )
                .toggleClass("clickable", a.nodeNumber === e.stage + 1)
                .on("click", () =>
                  (function (a) {
                    a.nodeNumber === Y().stage + 1 &&
                      a.canSelect &&
                      ((K = a), pa());
                  })(a)
                );
            var l;
            s.nodes.length > 1 &&
              a.optionNumber &&
              i.append(
                $("<div>")
                  .addClass("option-number")
                  .text(String(a.optionNumber))
              ),
              i.append(
                $("<div>").addClass("node-number").text(String(a.nodeNumber))
              ),
              i.append($("<div>").addClass("node-type").text(aa(a.type))),
              a.nodeNumber === e.stage &&
              i.append(
                $("<div>").addClass("current-marker").text("当前位置")
              ),
              n.append(i),
              s.nodes.length > 1 &&
              t < s.nodes.length - 1 &&
              n.append($("<div>").addClass("option-connector")),
              d.append(n);
          }),
            t.append(d),
            n < a.length - 1 &&
            t.append($("<div>").addClass("route-connector"));
        }),
        t
      );
    }
    function pa() {
      if (!W) return;
      if (G || !L)
        return void (W.innerHTML =
          '<div class="loading">正在加载 MVU 数据...</div>');
      const a = Y(),
        e = (function () {
          const a = Y();
          return Math.min(100, Math.round(((a.hp || 0) / 100) * 100));
        })(),
        t = (function () {
          if (!L) return [];
          const a = n().get(L.stat_data, "玩家数据.持有技能") || {};
          return Object.entries(a)
            .filter(([a]) => "$meta" !== a)
            .map(([a, e]) => {
              const t = e;
              return {
                name: a,
                charge: Number(Q(n().get(t, "当前充能"), 0)),
                chargeRequired: Math.max(
                  1,
                  Number(Q(n().get(t, "充能需求"), 1))
                ),
                desc: Q(n().get(t, "描述"), ""),
              };
            });
        })(),
        s = (function () {
          if (!L) return [];
          const a = n().get(L.stat_data, "玩家数据.持有藏品");
          if (!a) return [];
          const e = Array.isArray(a) ? a : [];
          return Array.isArray(e)
            ? e
              .filter((a) => a && "object" == typeof a)
              .map((a) => {
                const e = n().get(a, "名称"),
                  t = n().get(a, "描述");
                return { name: Q(e, ""), desc: Q(t, "") };
              })
              .filter((a) => a.name)
            : [];
        })(),
        d = (function () {
          if (!L) return [];
          const a = n().get(L.stat_data, "角色数据") || {},
            e = n().get(L.stat_data, "探索进度.在场角色"),
            t = Array.isArray(e) ? e : [];
          return Object.entries(a)
            .filter(([a]) => "$meta" !== a && "$template" !== a)
            .filter(([a]) => t.includes(a))
            .map(([a, e]) => {
              const t = e;
              return {
                name: a,
                status: Q(n().get(t, "状态"), "未知"),
                race: Q(n().get(t, "種族"), "未知"),
                personality: Q(n().get(t, "目前人格"), "未知"),
                triggerword: Q(n().get(t, "人格切換詞"), ""),
                corruption: Number(Q(n().get(t, "堕落程度"), 0)),
                clothing: Q(n().get(t, "服装"), "未描述"),
                characterStatus: Q(n().get(t, "人物状态"), "暂无状态描述"),
                bodyModification: Q(n().get(t, "身體改造"), {}),
                HoldItem: Q(n().get(t, "持有物品"), {}),
                armor: Number(Q(n().get(t, "护甲值"), 0)),
                relatedAnimal: Q(n().get(t, "有關母畜"), {}),
                leavePoint: Q(n().get(t, "離隊地點"), {}),
                brand: Q(n().get(t, "母畜烙印"), {}),
              };
            });
        })(),
        i = (function () {
          if (!L) return [];
          const a = n().get(L.stat_data, "商店数据.商品列表") || {};
          return Object.keys(a)
            .sort(
              (a, e) =>
                Number(a.replace("商品", "")) - Number(e.replace("商品", ""))
            )
            .map((e) => {
              const t = a[e],
                s = Array.isArray(t) ? t[0] : t,
                n = Array.isArray(t) ? t[1] : "",
                d = s?.名称 || "待刷新";
              return {
                key: e,
                item: s || null,
                slotDesc: n,
                isEmpty: "待刷新" === d,
                isPurchased: "string" == typeof d && d.includes("已购买"),
                displayName: d,
              };
            });
        })(),
        items = (function () {
          if (!L) return [];
          const raw = n().get(L.stat_data, "玩家数据.持有道具");
          if (!raw) return [];
          const list = Array.isArray(raw) ? raw : [];
          return list
            .filter((i) => i && "object" == typeof i)
            .map((i) => {
              return {
                name: Q(n().get(i, "名称"), ""),
                desc: Q(n().get(i, "描述"), ""),
                effect: Q(n().get(i, "效果"), ""),
                count: Number(Q(n().get(i, "數量"), 0)),
              };
            })
            .filter((i) => i.name);
        })(),
        buffs = (function () {
          if (!L) return [];
          const raw = n().get(L.stat_data, "玩家数据.持有增益");
          if (!raw) return [];
          const list = Array.isArray(raw) ? raw : [];
          return list
            .filter((i) => i && "object" == typeof i)
            .map((i) => {
              return {
                name: Q(n().get(i, "名称"), ""),
                desc: Q(n().get(i, "描述"), ""),
              };
            })
            .filter((i) => i.name);
        })(),
        l = $("<div>").addClass("ark-root"),
        o = $("<div>").addClass("route-map-panel"),
        c = $("<div>").addClass("panel-header");
      c.append(
        $("<div>").addClass("panel-title").text(`第 ${a.layer} 层路线图`)
      ),
        c.append($("<div>").addClass("panel-sub").text(`当前节点: ${a.stage}`));
      const r = $("<div>").addClass("route-map-container");
      r.append(ra()), o.append(c).append(r), l.append(o);
      const p = $("<div>").addClass("top-stack"),
        u = $("<div>").addClass("progress-card"),
        f = $("<div>").addClass("card-title-row");
      f.append($("<div>").addClass("card-title").text("生命状态"));
      const v = $("<div>").addClass("info-row");
      a.squad &&
        "无" !== a.squad &&
        v.append(
          $("<div>")
            .addClass("squad-display")
            .html(
              `<span class="squad-label">当前分队</span><span class="squad-name">${a.squad}</span>`
            )
        ),
        a.difficulty &&
        "无" !== a.difficulty &&
        v.append(
          $("<div>")
            .addClass("difficulty-display")
            .html(
              `<span class="difficulty-label">难度</span><span class="difficulty-name">${a.difficulty}</span>`
            )
        ),
        "异想天开分队" === a.squad &&
        a.fetishTerm &&
        v.append(
          $("<div>")
            .addClass("fetish-term-display")
            .html(
              `<span class="fetish-term-label">世界性癖</span><span class="fetish-term-name">${a.fetishTerm}</span>`
            )
        ),
        v.children().length > 0 && f.append(v),
        u.append(f);
      const g = $("<div>").addClass("hp-line"),
        m = $("<div>").addClass("hp-label");
      m.append($("<span>").addClass("label").text("体力值")),
        m.append($("<span>").addClass("value").text(`${a.hp}`));
      const C = $("<div>").addClass("hp-bar");
      C.append($("<div>").addClass("hp-bar-fill").css("width", `${e}%`)),
        g.append(m).append(C);
      const b = $("<div>").addClass("resource-grid");
      b.append(
        $("<div>")
          .addClass("resource-pill primary")
          .html(
            '<span class="pill-label">淫欲值</span><span class="pill-value">' +
            a.lust +
            "</span>"
          ),
        $("<div>")
          .addClass("resource-pill highlight")
          .html(
            '<span class="pill-label">精液配给</span><span class="pill-value">' +
            a.semen +
            "</span>"
          ),
        $("<div>")
          .addClass("resource-pill ghost")
          .html(
            '<span class="pill-label">当前层数</span><span class="pill-value">' +
            a.layer +
            "</span>"
          ),
        $("<div>")
          .addClass("resource-pill ghost")
          .html(
            '<span class="pill-label">当前关卡</span><span class="pill-value">' +
            a.stage +
            "</span>"
          )
      ),
        u.append(g).append(b);

      // Player Buffs
      if (buffs.length > 0) {
        const buffGrid = $("<div>").addClass("resource-grid");
        buffs.forEach((buff) => {
          buffGrid.append(
            $("<div>")
              .addClass("resource-pill player-buff")
              .html(
                `<span class="pill-label">${buff.name
                }</span><span class="pill-desc">${buff.desc || ""}</span>`
              )
          );
        });
        u.append(buffGrid);
      }
      p.append(u);
      const y = $("<div>").addClass("panel"),
        h = $("<div>").addClass("panel-header");
      h.append($("<div>").addClass("panel-title").text("技能准备"))
        .append(
          $("<div>")
            .addClass("panel-actions")
            .append(
              $("<button>")
                .addClass("ghost-btn")
                .text(isSkillsExpanded ? "折叠" : "展开")
                .on("click", () => {
                  isSkillsExpanded = !isSkillsExpanded;
                  pa();
                })
            )
        );
      y.append(h);

      if (isSkillsExpanded) {
        const x = $("<div>").addClass("skills-grid");
        0 === t.length
          ? x.append($("<div>").addClass("empty").text("暂无技能"))
          : t.forEach((a) => {
            const e = a.charge >= a.chargeRequired,
              t = $("<button>")
                .addClass("skill-btn")
                .toggleClass("disabled", !e)
                .on("click", () => {
                  e && ia(a.name);
                });
            t.append($("<div>").addClass("skill-name").text(a.name)),
              t.append(
                $("<div>")
                  .addClass("skill-desc")
                  .text(a.desc || "无描述")
              );
            const s = $("<div>").addClass("skill-footer");
            s.append(
              $("<span>").text(`充能: ${a.charge} / ${a.chargeRequired}`)
            ),
              a.charge < a.chargeRequired
                ? s.append($("<span>").addClass("cd-tag").text("未就绪"))
                : s.append($("<span>").addClass("ready-tag").text("就绪")),
              t.append(s),
              x.append(t);
          });
        y.append(x);
      }
      p.append(y), l.append(p);
      const E = $("<div>").addClass("panel wide split-container");
      E.append(
        $("<div>")
          .addClass("panel-header split-header")
          .append($("<div>").addClass("panel-title").text("藏品-道具 列表"))
          .append(
            $("<div>")
              .addClass("panel-actions")
              .append(
                $("<button>")
                  .addClass("ghost-btn")
                  .text(isCollListExpanded ? "折叠" : "展开")
                  .on("click", () => {
                    isCollListExpanded = !isCollListExpanded;
                    pa();
                  })
              )
          )
      );

      if (isCollListExpanded) {
        const splitCollections = $("<div>").addClass("panel split-collections");
        splitCollections.append(
          $("<div>")
            .addClass("panel-header")
            .append($("<div>").addClass("panel-title").text("藏品列表"))
        );
        const M = $("<div>").addClass("collections-grid");
        0 === s.length
          ? M.append($("<div>").addClass("empty").text("暂无藏品"))
          : s.forEach((a) => {
            const e = $("<div>").addClass("collection-card");
            e.append($("<div>").addClass("collection-name").text(a.name)),
              e.append(
                $("<div>")
                  .addClass("collection-desc")
                  .text(a.desc || "无描述")
              ),
              M.append(e);
          });
        splitCollections.append(M);
        E.append(splitCollections);

        const splitItems = $("<div>").addClass("panel split-items");
        splitItems.append(
          $("<div>")
            .addClass("panel-header")
            .append($("<div>").addClass("panel-title").text("道具列表"))
        );
        const itemGrid = $("<div>").addClass("items-grid");
        if (items.length === 0) {
          itemGrid.append($("<div>").addClass("empty").text("暂无道具"));
        } else {
          items.forEach((item) => {
            const itemCard = $("<div>").addClass("item-card");
            const nameRow = $("<div>")
              .addClass("item-list-name")
              .text(item.name);
            if (item.count > 0) {
              nameRow.append(
                $("<div>")
                  .addClass("item-list-quantity")
                  .text(`x${item.count}`)
              );
            }
            itemCard.append(nameRow);

            let fullDesc = item.desc || "";
            if (item.effect) {
              fullDesc = fullDesc ? `${fullDesc}、${item.effect}` : item.effect;
            }

            itemCard.append(
              $("<div>")
                .addClass("item-list-desc")
                .text(fullDesc || "无描述")
            );
            itemGrid.append(itemCard);
          });
        }
        splitItems.append(itemGrid);
        E.append(splitItems);
      }

      l.append(E);

      const w = $("<div>").addClass("panel wide");
      w.append(
        $("<div>")
          .addClass("panel-header")
          .append($("<div>").addClass("panel-title").text("角色状态"))
          .append(
            $("<div>")
              .addClass("panel-actions")
              .append(
                $("<button>")
                  .addClass("ghost-btn")
                  .text(isCharStatusExpanded ? "折叠" : "展开")
                  .on("click", () => {
                    isCharStatusExpanded = !isCharStatusExpanded;
                    pa();
                  })
              )
          )
      );

      if (isCharStatusExpanded) {
        const k = $("<div>").addClass("character-grid");
        0 === d.length
          ? k.append($("<div>").addClass("empty").text("暂无角色状态"))
          : d.forEach((a) => {
            const e = $("<div>")
              .addClass("char-card")
              .on("click", () => ((H = a), void pa()));
            const t = $("<div>").addClass("char-header");
            t.append(
              $("<span>")
                .addClass("name")
                .text(a.name)
                .append(
                  $("<span>").addClass("trigger-word").text(a.triggerword)
                )
            );
            const sub = $("<div>").addClass("dialog-sub");
            sub.append(
              $("<span>")
                .addClass("badge")
                .toggleClass("corrupted", "堕落" === a.status)
                .toggleClass("hostile", "敌对" === a.status)
                .toggleClass("promoted", "母畜" === a.status)
                .toggleClass("neutral", "中立" === a.status)
                .text(a.status || "未知")
            );
            if (a.race) {
              sub.append($("<span>").addClass("badge race").text(a.race));
            }
            if (a.personality) {
              let pClass = "badge";
              if (
                (a.personality || "").startsWith("母畜") ||
                (a.personality || "").startsWith("母畜") 
              )
                pClass += " promoted";
              else if (
                (a.personality || "").startsWith("堕落") ||
                (a.personality || "").startsWith("墮落")
              )
                pClass += " corrupted";
              else pClass += " neutral";
              sub.append($("<span>").addClass(pClass).text(a.personality));
            }
            t.append(sub);
            const n = $("<div>").addClass("char-body");
            n.append(
              $("<div>")
                .addClass("clothing-line")
                .html(
                  `<span class="label">服装</span><span class="value">${a.clothing}</span>`
                )
            );
            const d = $("<div>").addClass("stat-line");
            d.append($("<span>").addClass("label").text("堕落度"));
            const i = $("<div>").addClass("bar");
            i.append(
              $("<div>")
                .addClass("fill orange")
                .css("width", `${Math.min(100, a.corruption)}%`)
            ),
              d.append(i),
              d.append(
                $("<span>").addClass("value").text(`${a.corruption}/100`)
              ),
              n.append(d);
            const l = Z(Y().difficulty);
            if (l > 0) {
              const e = $("<div>").addClass("stat-line");
              e.append($("<span>").addClass("label").text("理智护甲"));
              const t = $("<div>").addClass("bar"),
                s = l > 0 ? Math.min(100, Math.round((a.armor / l) * 100)) : 0;
              t.append($("<div>").addClass("fill blue").css("width", `${s}%`)),
                e.append(t),
                e.append($("<span>").addClass("value").text(`${a.armor}/${l}`)),
                n.append(e);
            }
            e.append(t).append(n), k.append(e);
          });
        w.append(k);
      }
      l.append(w);
      const D = $("<div>").addClass("panel wide"),
        A = $("<div>").addClass("panel-header"),
        N =
          J.length > 0
            ? `使用精液配给购买补给（待购买：${J.length}件）`
            : "使用精液配给购买补给";
      A.append(
        $("<div>").html(
          `<div class="panel-title">黑市商店</div><div class="panel-sub">${N}</div>`
        )
      );
      const S = $("<div>").addClass("panel-actions");
      if (
        (J.length > 0 &&
          (S.append(
            $("<button>")
              .addClass("confirm-btn")
              .text(`完成购买(${J.length})`)
              .on("click", la)
          ),
            S.append(
              $("<button>").addClass("ghost-btn").text("清空").on("click", oa)
            )),
          S.append(
            $("<button>")
              .addClass("ghost-btn")
              .text(U ? "折叠" : "展开")
              .on("click", () => {
                (U = !U), pa();
              })
          ),
          A.append(S),
          D.append(A),
          U)
      ) {
        const a = $("<div>").addClass("shop-grid");
        i.forEach((e) => {
          const t = $("<div>")
            .addClass("shop-card")
            .toggleClass("disabled", e.isEmpty || e.isPurchased)
            .on(
              "click",
              () =>
                !e.isEmpty &&
                !e.isPurchased &&
                (function (a) {
                  (j = a), pa();
                })(e)
            ),
            s = $("<div>").addClass("card-top");
          s.append($("<span>").addClass("item-name").text(e.displayName)),
            s.append(
              $("<span>")
                .addClass("tag")
                .text(e.item?.类型 || "未知")
            );
          const n = $("<div>").addClass("price-line");
          n.append($("<span>").addClass("label").text("价格")),
            n.append(
              $("<span>")
                .addClass("value")
                .text(String(e.item?.价格 ?? "--"))
            ),
            t
              .append(s)
              .append(n)
              .append(
                $("<div>")
                  .addClass("desc")
                  .text(e.item?.描述 || e.slotDesc || "暂无描述")
              ),
            a.append(t);
        }),
          D.append(a);
      }
      if ((l.append(D), j)) {
        const a = $("<div>").addClass("dialog-mask").on("click", na),
          e = $("<div>")
            .addClass("dialog")
            .on("click", (a) => a.stopPropagation()),
          t = $("<div>").addClass("dialog-header");
        t.append(
          $("<div>").html(
            `<div class="dialog-title">${j.displayName
            }</div><div class="dialog-sub">${j.item?.类型 || ""}</div>`
          )
        ),
          t.append($("<button>").addClass("close").text("×").on("click", na));
        const s = $("<div>").addClass("dialog-body");
        s.append(
          $("<div>")
            .addClass("dialog-desc")
            .text(j.item?.描述 || "暂无描述")
        ),
          s.append(
            $("<div>")
              .addClass("dialog-price")
              .html(`价格：<span>${j.item?.价格 ?? "--"}</span>`)
          );
        const n = $("<div>").addClass("dialog-actions");
        n.append(
          $("<button>").addClass("ghost-btn").text("取消").on("click", na)
        ),
          n.append(
            $("<button>")
              .addClass("confirm-btn")
              .prop(
                "disabled",
                !(function (a) {
                  if (!a || !a.item) return !1;
                  const e = Number(a.item.价格 || 0);
                  return Y().semen >= e;
                })(j)
              )
              .text("购买")
              .on("click", () => {
                j &&
                  (function (a) {
                    if (!a.item) return;
                    const e = Number(a.item.价格 || 0);
                    if (Y().semen < e) return;
                    const t = a.item.名称 || "未知物品";
                    J.push(t), na(), pa();
                  })(j);
              })
          ),
          e.append(t).append(s).append(n),
          a.append(e),
          l.append(a);
      }
      if (H) {
        const a = $("<div>").addClass("dialog-mask").on("click", da),
          e = $("<div>")
            .addClass("dialog character-dialog")
            .on("click", (a) => a.stopPropagation()),
          t = $("<div>").addClass("dialog-header"),
          s = $("<div>").addClass("dialog-header-content");
        s.append(
          $("<div>")
            .addClass("dialog-title")
            .text(H.name)
            .append($("<span>").addClass("trigger-word").text(H.triggerword))
          .append($("<span>").addClass("promoted-tattoo").text(H.brand.描述 || "").append(H.brand.描述 ? "(" : "").append(H.brand.位置 || "").append(H.brand.描述 ? ")" : ""))
        );
        const n = $("<div>").addClass("dialog-sub");
        n.append(
          $("<span>")
            .addClass("badge")
            .toggleClass("corrupted", "堕落" === H.status)
            .toggleClass("hostile", "敌对" === H.status)
            .toggleClass("promoted", "母畜" === H.status)
            .toggleClass("neutral", "中立" === H.status)
            .text(H.status || "未知")
        );
        H.race && n.append($("<span>").addClass("badge race").text(H.race));
        if (H.personality) {
          let personalityClass = "badge";
          if (
            (H.personality || "").startsWith("母畜") ||
            (H.personality || "").startsWith("母畜") 
          )
            personalityClass += " promoted";
          else if (
            (H.personality || "").startsWith("堕落") ||
            (H.personality || "").startsWith("墮落")
          )
            personalityClass += " corrupted";
          else personalityClass += " neutral"; // Default style
          n.append($("<span>").addClass(personalityClass).text(H.personality));
        }
        s.append(n),
          t.append(s),
          t.append($("<button>").addClass("close").text("×").on("click", da));
        const d = $("<div>").addClass("dialog-body"),
          i = $("<div>").addClass("character-detail-section");
        i.append(
          $("<div>")
            .addClass("detail-item")
            .html(
              `<span class="detail-label">服装</span><span class="detail-value">${H.clothing}</span>`
            )
        );

        // Items Held
        if (H.HoldItem && Object.keys(H.HoldItem).length > 0) {
          const itemContainer = $("<div>").addClass("detail-item complexed");
          itemContainer.append(
            $("<span>").addClass("detail-label").text("持有物品")
          );
          Object.entries(H.HoldItem).forEach(([itemName, itemData]) => {
            const itemType = itemData.物品種類 || "道具";
            const badgeClass =
              itemType === "藏品" ? "badge collections" : "badge items";
            itemContainer.append(
              $("<span>").addClass(badgeClass).text(itemName)
            );
          });
          i.append(itemContainer);
        }

        const o = $("<div>").addClass("detail-item");
        o.append($("<span>").addClass("detail-label").text("堕落度"));
        const c = $("<div>").addClass("detail-bar-container"),
          r = $("<div>").addClass("detail-bar");
        r.append(
          $("<div>")
            .addClass("detail-bar-fill orange")
            .css("width", `${Math.min(100, H.corruption)}%`)
        ),
          c.append(r),
          c.append(
            $("<span>").addClass("detail-bar-value").text(`${H.corruption}/100`)
          ),
          o.append(c),
          i.append(o);
        const p = Y(),
          u = Z(p.difficulty);
        if (u > 0) {
          const a = $("<div>").addClass("detail-item");
          a.append($("<span>").addClass("detail-label").text("理智护甲"));
          const e = $("<div>").addClass("detail-bar-container"),
            t = $("<div>").addClass("detail-bar"),
            s = u > 0 ? Math.min(100, Math.round((H.armor / u) * 100)) : 0;
          t.append(
            $("<div>").addClass("detail-bar-fill blue").css("width", `${s}%`)
          ),
            e.append(t),
            e.append(
              $("<span>").addClass("detail-bar-value").text(`${H.armor}/${u}`)
            ),
            a.append(e),
            i.append(a);
        }

        // Mother Related
        if (H.relatedAnimal && Object.keys(H.relatedAnimal).length > 0) {
          const motherList = Object.entries(H.relatedAnimal)
            .map(([name, relation]) => `${name}(${relation})`)
            .join("、");
          i.append(
            $("<div>")
              .addClass("detail-item")
              .html(
                `<span class="detail-label">有关母畜</span><span class="detail-value">${motherList}</span>`
              )
          );
        }

        // Body Modification
        // Assuming H.bodyModification is a Record<string, string>
        if (H.bodyModification && Object.keys(H.bodyModification).length > 0) {
          const modText = Object.entries(H.bodyModification)
            .map(([part, mod]) => `${part}有${mod}`)
            .join("、");
          i.append(
            $("<div>")
              .addClass("detail-item full-width")
              .html(
                `<span class="detail-label">身体改造</span><div class="character-status-text">${modText}</div>`
              )
          );
        }

        // Character Status
        i.append(
          $("<div>")
            .addClass("detail-item full-width")
            .html(
              `<span class="detail-label">人物状态</span><div class="character-status-text">${H.characterStatus || "暂无状态描述"
              }</div>`
            )
        );

        // Departure Location
        if (H.leavePoint && Object.keys(H.leavePoint).length > 0) {
          const layer = H.leavePoint.層數;
          const node = H.leavePoint.節點;
          i.append(
            $("<div>")
              .addClass("detail-item")
              .html(
                `<span class="detail-label">离队地点</span><span class="detail-value">第${layer}层-节点${node}</span>`
              )
          );
        }

        if ("堕落" === H.status) {
          const a = $("<div>").addClass(
            "detail-item full-width promotion-section"
          ),
            e = $("<div>").addClass("promotion-info");
          e.append($("<div>").addClass("promotion-label").text("晋升为母畜")),
            e.append(
              $("<div>").addClass("promotion-cost").text("消耗淫欲值: 6")
            ),
            e.append(
              $("<div>").addClass("promotion-tip").text(`当前淫欲值: ${p.lust}`)
            ),
            a.append(e),
            i.append(a);
        }
        d.append(i);
        const f = $("<div>").addClass("dialog-actions");
        f.append(
          $("<button>").addClass("ghost-btn").text("关闭").on("click", da)
        ),
          "堕落" === H.status &&
          f.append(
            $("<button>")
              .addClass("confirm-btn")
              .prop("disabled", p.lust < 6)
              .text("晋升为母畜")
              .on("click", sa)
          ),
          e.append(t).append(d).append(f),
          a.append(e),
          l.append(a);
      }
      if (K) {
        const e = $("<div>").addClass("dialog-mask").on("click", ea),
          t = $("<div>")
            .addClass("dialog node-dialog")
            .on("click", (a) => a.stopPropagation()),
          s = $("<div>").addClass("dialog-header");
        s.append(
          $("<div>").html(
            `<div class="dialog-title">节点 ${K.nodeNumber} - ${aa(
              K.type
            )}</div><div class="dialog-sub">关卡信息</div>`
          )
        ),
          s.append($("<button>").addClass("close").text("×").on("click", ea));
        const n = $("<div>").addClass("dialog-body"),
          d = $("<div>").addClass("node-data-content");
        if (["作战", "紧急作战", "险路恶敌"].includes(K.type)) {
          const a = $("<div>").addClass("node-info");
          if (K.combatData) {
            const e = $("<div>").addClass("combat-info");
            if (K.combatData.描述) {
              const a = $("<div>").addClass("combat-description");
              a.append(
                $("<div>").addClass("description-label").text("作战描述")
              ),
                a.append(
                  $("<div>")
                    .addClass("description-content")
                    .text(String(K.combatData.描述))
                ),
                e.append(a);
            }
            Object.entries(K.combatData).forEach(([a, t]) => {
              if ("描述" !== a) {
                const s = $("<div>").addClass("combat-info-item");
                s.append($("<span>").addClass("combat-label").text(`${a}:`)),
                  s.append(
                    $("<span>")
                      .addClass("combat-value")
                      .text(
                        "object" == typeof t
                          ? JSON.stringify(t, null, 2)
                          : String(t)
                      )
                  ),
                  e.append(s);
              }
            }),
              a.append(e);
          } else
            a.append(
              $("<div>").addClass("combat-info-empty").text("暂无作战资料")
            );
          d.append(a);
        } else {
          const a = $("<div>").addClass("node-info"),
            e = $("<div>").addClass("node-type-info");
          e.append($("<div>").addClass("type-label").text("关卡类型")),
            e.append($("<div>").addClass("type-value").text(aa(K.type))),
            a.append(e),
            d.append(a);
        }
        n.append(d);
        const i = $("<div>").addClass("dialog-actions");
        i.append(
          $("<button>").addClass("ghost-btn").text("取消").on("click", ea)
        ),
          K.nodeNumber === a.stage + 1 &&
          i.append(
            $("<button>")
              .addClass("confirm-btn")
              .text("确认选择")
              .on("click", ta)
          ),
          t.append(s).append(n).append(i),
          e.append(t),
          l.append(e);
      }
      (W.innerHTML = ""), W.appendChild(l[0]);
    }
    function ua(a, e) {
      return Array.isArray(a) && a.length > 0 ? a[0] : a ?? e;
    }
    function fa() {
      try {
        const a = { type: "message", message_id: "latest" },
          e = Mvu.getMvuData(a);
        if (e?.stat_data) {
          const a = ua(n().get(e.stat_data, "探索进度.当前层数"), 0);
          return Number(a) || 0;
        }
      } catch (a) {
        console.warn("Failed to get current layer:", a);
      }
      return 0;
    }
    function va() {
      try {
        const a = { type: "message", message_id: "latest" },
          e = Mvu.getMvuData(a);
        if (e?.stat_data) {
          return ua(n().get(e.stat_data, "玩家数据.选择分队"), "") || "无";
        }
      } catch (a) {
        console.warn("Failed to get selected squad:", a);
      }
      return "无";
    }
    function ga() {
      try {
        const a = { type: "message", message_id: "latest" },
          e = Mvu.getMvuData(a);
        if (e?.stat_data) {
          const a = ua(
            n().get(e.stat_data, "玩家数据.当前层世界性癖词条层数"),
            0
          );
          return Number(a) || 0;
        }
      } catch (a) {
        console.warn("Failed to get fetish term layer:", a);
      }
      return 0;
    }
    async function ma() {
      const a = fa(),
        e = va(),
        t = (function () {
          try {
            const a = { type: "message", message_id: "latest" },
              e = Mvu.getMvuData(a);
            if (e?.stat_data)
              return (
                ua(n().get(e.stat_data, "玩家数据.当前层世界性癖词条"), "") ||
                ""
              );
          } catch (a) {
            console.warn("Failed to get current fetish term:", a);
          }
          return "";
        })(),
        s = ga();
      if ("异想天开分队" === e && t && s !== a) {
        const e = { type: "message", message_id: "latest" };
        try {
          const s = Mvu.getMvuData(e);
          s &&
            (n().set(s, "stat_data.玩家数据.当前层世界性癖词条层数", a),
              await Mvu.replaceMvuData(s, e),
              console.info(`[世界性癖词条] AI生成了新词条: ${t}（第${a}层）`));
        } catch (a) {
          console.warn("Failed to track fetish term:", a);
        }
      }
    }
    $(() => {
      if (((W = document.getElementById("status-app")), !W)) return;
      let a = null;
      const e = () => {
        a && clearTimeout(a),
          (a = setTimeout(() => {
            ca();
          }, 150));
      };
      (async () => {
        await waitGlobalInitialized("Mvu"),
          ca(),
          (G = !1),
          pa(),
          eventOn &&
          Mvu?.events?.VARIABLE_UPDATE_ENDED &&
          eventOn(Mvu.events.VARIABLE_UPDATE_ENDED, e),
          eventOn &&
          tavern_events?.MESSAGE_RECEIVED &&
          eventOn(tavern_events.MESSAGE_RECEIVED, e);
      })();
    });
    let $a = 0,
      Ca = "";
    function ba() {
      const a = fa(),
        e = va();
      if (a !== $a || e !== Ca) {
        const t = $a;
        ($a = a),
          (Ca = e),
          "异想天开分队" === e &&
          t > 0 &&
          (async function () {
            const a = fa(),
              e = va(),
              t = ga();
            if ("异想天开分队" === e && a !== t && t > 0) {
              const e = { type: "message", message_id: "latest" };
              try {
                const t = Mvu.getMvuData(e);
                t &&
                  (n().set(t, "stat_data.玩家数据.当前层世界性癖词条", ""),
                    n().set(t, "stat_data.玩家数据.当前层世界性癖词条层数", a),
                    await Mvu.replaceMvuData(t, e),
                    console.info(
                      `[世界性癖词条] 层数变化，清空旧词条，等待AI生成新词条（第${a}层）`
                    ));
              } catch (a) {
                console.warn("Failed to clear fetish term:", a);
              }
            }
          })();
      } else 0 === $a && (($a = a), (Ca = e));
      "异想天开分队" === e && ma();
    }
    $(() => {
      (async () => {
        await waitGlobalInitialized("Mvu"),
          ba(),
          eventOn &&
          Mvu?.events?.VARIABLE_UPDATE_ENDED &&
          eventOn(Mvu.events.VARIABLE_UPDATE_ENDED, () => {
            ba();
          }),
          eventOn &&
          tavern_events?.MESSAGE_RECEIVED &&
          eventOn(tavern_events.MESSAGE_RECEIVED, () => {
            setTimeout(() => {
              ba();
            }, 100);
          });
      })();
    });
    t(286);
    //# sourceMappingURL=index.js.map
  </script>
  <style>
    @import url(https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Noto+Sans+SC:wght@300;400;600;700&display=swap);
    @import url(https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Noto+Sans+SC:wght@300;400;600;700&display=swap);
    @import url(https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Noto+Sans+SC:wght@300;400;600;700&display=swap);
    @import url(https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Noto+Sans+SC:wght@300;400;600;700&display=swap);

    /*! tailwindcss v4.1.18 | MIT License | https://tailwindcss.com */
    .difficulty-selector-root {
      font-family: "Inter", "Noto Sans SC", sans-serif;
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #0d1117 0%, #0b0f15 100%);
      color: #e6f7ff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 20px;
      padding-top: 40px;
      z-index: 9999;
      overflow-y: auto;
      max-height: 100vh;
    }

    .difficulty-selector-root::-webkit-scrollbar {
      width: 10px;
    }

    .difficulty-selector-root::-webkit-scrollbar-track {
      background: rgba(31, 42, 61, 0.3);
      border-radius: 5px;
    }

    .difficulty-selector-root::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #22d3ee, #0ea5e9);
      border-radius: 5px;
      -webkit-transition: background 0.2s;
      transition: background 0.2s;
    }

    .difficulty-selector-root::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg,
          rgb(81.3571428571, 220.4285714286, 241.6428571429),
          rgb(55.016194332, 184.6194331984, 242.983805668));
    }

    .difficulty-title-section {
      text-align: center;
      margin-bottom: 30px;
      width: 100%;
      max-width: 900px;
    }

    .difficulty-main-title {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 8px;
      background: linear-gradient(135deg, #22d3ee, #0ea5e9);
      -webkit-background-clip: text;
      -webkit-text-fill-color: rgba(0, 0, 0, 0);
      background-clip: text;
    }

    .difficulty-subtitle {
      font-size: 16px;
      color: #9db1c9;
    }

    .difficulty-grid {
      display: flex;
      flex-direction: column;
      gap: 16px;
      width: 100%;
      max-width: 900px;
      margin-bottom: 30px;
    }

    .difficulty-card {
      background: rgba(17, 24, 33, 0.95);
      border: 2px solid #1f2a3d;
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: visible;
    }

    .difficulty-card:hover:not(.confirmed) {
      border-color: var(--difficulty-color, #0ea5e9);
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(var(--difficulty-color-rgb, 14, 165, 233), 0.3);
    }

    .difficulty-card.selected {
      border-color: var(--difficulty-color, #0ea5e9);
      box-shadow: 0 0 0 3px rgba(var(--difficulty-color-rgb, 14, 165, 233), 0.2);
    }

    .difficulty-card.confirmed {
      cursor: default;
      opacity: 0.7;
      border-color: var(--difficulty-color, #0ea5e9);
      box-shadow: 0 0 12px rgba(var(--difficulty-color-rgb, 14, 165, 233), 0.4);
    }

    .difficulty-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .difficulty-card-name {
      font-size: 22px;
      font-weight: 600;
      color: var(--difficulty-color, #0ea5e9);
    }

    .difficulty-card-armor {
      font-size: 14px;
      color: #9db1c9;
      background: rgba(var(--difficulty-color-rgb, 14, 165, 233), 0.1);
      padding: 4px 12px;
      border-radius: 12px;
    }

    .difficulty-card-body {
      margin-bottom: 16px;
    }

    .difficulty-card-desc {
      font-size: 16px;
      color: #e6f7ff;
      line-height: 1.6;
      min-height: 48px;
    }

    .difficulty-card-footer {
      display: flex;
      justify-content: flex-end;
      align-items: center;
    }

    .difficulty-detail-btn {
      background: rgba(0, 0, 0, 0);
      border: 1px solid var(--difficulty-color, #0ea5e9);
      color: var(--difficulty-color, #0ea5e9);
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    .difficulty-detail-btn:hover {
      background: rgba(var(--difficulty-color-rgb, 14, 165, 233), 0.1);
    }

    .difficulty-confirmed-badge {
      background: var(--difficulty-color, #0ea5e9);
      color: #fff;
      padding: 6px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    .difficulty-action-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      width: 100%;
      max-width: 900px;
    }

    .difficulty-confirmed-info {
      text-align: center;
      padding: 12px 24px;
      background: rgba(var(--difficulty-color-rgb, 14, 165, 233), 0.1);
      border: 1px solid var(--difficulty-color, #0ea5e9);
      border-radius: 8px;
    }

    .difficulty-confirmed-label {
      font-size: 12px;
      color: #9db1c9;
      margin-bottom: 4px;
    }

    .difficulty-confirmed-name {
      font-size: 18px;
      font-weight: 600;
      color: var(--difficulty-color, #0ea5e9);
    }

    .difficulty-start-btn {
      background: linear-gradient(135deg, #22d3ee, #0ea5e9);
      color: #fff;
      border: none;
      padding: 14px 32px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      width: 100%;
      max-width: 300px;
    }

    .difficulty-start-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(14, 165, 233, 0.4);
    }

    .difficulty-start-btn:active {
      transform: translateY(0);
    }

    .difficulty-dialog-mask {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      z-index: 10000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .difficulty-dialog {
      background: rgba(17, 24, 33, 0.95);
      border: 2px solid var(--difficulty-color, #0ea5e9);
      border-radius: 16px;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(var(--difficulty-color-rgb, 14, 165, 233), 0.3);
    }

    .difficulty-dialog::-webkit-scrollbar {
      width: 8px;
    }

    .difficulty-dialog::-webkit-scrollbar-track {
      background: rgba(31, 42, 61, 0.3);
      border-radius: 4px;
    }

    .difficulty-dialog::-webkit-scrollbar-thumb {
      background: var(--difficulty-color, #0ea5e9);
      border-radius: 4px;
    }

    .difficulty-dialog-header {
      padding: 24px;
      border-bottom: 1px solid #1f2a3d;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
    }

    .difficulty-dialog-title {
      font-size: 24px;
      font-weight: 700;
      color: var(--difficulty-color, #0ea5e9);
      flex: 1;
    }

    .difficulty-dialog-armor {
      font-size: 16px;
      color: #9db1c9;
      background: rgba(var(--difficulty-color-rgb, 14, 165, 233), 0.1);
      padding: 6px 12px;
      border-radius: 8px;
      margin-top: 4px;
    }

    .difficulty-dialog-close {
      background: rgba(0, 0, 0, 0);
      border: none;
      color: #9db1c9;
      font-size: 28px;
      cursor: pointer;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: all 0.2s;
    }

    .difficulty-dialog-close:hover {
      background: rgba(157, 177, 201, 0.1);
      color: #e6f7ff;
    }

    .difficulty-dialog-body {
      padding: 24px;
    }

    .difficulty-dialog-desc {
      font-size: 16px;
      color: #e6f7ff;
      line-height: 1.6;
      margin-bottom: 24px;
    }

    .difficulty-features-title,
    .difficulty-experience-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--difficulty-color, #0ea5e9);
      margin-bottom: 12px;
      margin-top: 20px;
    }

    .difficulty-features-list {
      margin-bottom: 24px;
    }

    .difficulty-feature-item {
      font-size: 15px;
      color: #e6f7ff;
      line-height: 1.6;
      margin-bottom: 8px;
      padding-left: 8px;
    }

    .difficulty-experience-text {
      font-size: 15px;
      color: #9db1c9;
      line-height: 1.6;
      padding: 12px;
      background: rgba(var(--difficulty-color-rgb, 14, 165, 233), 0.05);
      border-left: 3px solid var(--difficulty-color, #0ea5e9);
      border-radius: 4px;
    }

    .difficulty-dialog-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid #1f2a3d;
    }

    .difficulty-dialog-cancel-btn,
    .difficulty-dialog-confirm-btn {
      padding: 10px 20px;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }

    .difficulty-dialog-cancel-btn {
      background: rgba(0, 0, 0, 0);
      color: #9db1c9;
      border: 1px solid #1f2a3d;
    }

    .difficulty-dialog-cancel-btn:hover {
      background: rgba(157, 177, 201, 0.1);
      color: #e6f7ff;
    }

    .difficulty-dialog-confirm-btn {
      background: var(--difficulty-color, #0ea5e9);
      color: #fff;
    }

    .difficulty-dialog-confirm-btn:hover {
      background: var(--difficulty-color, #0ea5e9);
      opacity: 0.9;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(var(--difficulty-color-rgb, 14, 165, 233), 0.3);
    }

    @media (max-width: 768px) {
      .difficulty-selector-root {
        padding: 16px;
        padding-top: 32px;
      }

      .difficulty-main-title {
        font-size: 24px;
      }

      .difficulty-subtitle {
        font-size: 14px;
      }

      .difficulty-card {
        padding: 16px;
      }

      .difficulty-card-name {
        font-size: 18px;
      }

      .difficulty-card-desc {
        font-size: 15px;
      }

      .difficulty-dialog {
        max-width: 100%;
        margin: 10px;
      }

      .difficulty-dialog-header {
        padding: 16px;
      }

      .difficulty-dialog-body {
        padding: 16px;
      }
    }

    /*! tailwindcss v4.1.18 | MIT License | https://tailwindcss.com */
    .options-root {
      font-family: "Inter", "Noto Sans SC", sans-serif;
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      max-width: 90vw;
      width: 800px;
      pointer-events: auto;
    }

    .options-panel {
      background: rgba(17, 24, 33, 0.9);
      border: 1px solid #1f2a3d;
      padding: 16px;
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.45);
      position: relative;
      overflow: visible;
      max-height: calc(80vh - 40px);
      display: flex;
      flex-direction: column;
    }

    .options-panel::after {
      content: "";
      position: absolute;
      inset: 0;
      border: 1px solid rgba(34, 211, 238, 0.12);
      pointer-events: none;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 12px;
      cursor: pointer;
      -webkit-user-select: none;
      user-select: none;
      transition: opacity 0.2s;
    }

    .panel-header:hover {
      opacity: 0.8;
    }

    .panel-header-content {
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
    }

    .expand-icon {
      font-size: 12px;
      color: #6b829d;
      transition: transform 0.2s;
    }

    .expand-icon.expanded {
      transform: rotate(180deg);
    }

    .panel-title {
      font-size: 16px;
      font-weight: 700;
      color: #e6f7ff;
      letter-spacing: 0.6px;
      text-transform: uppercase;
    }

    .panel-sub {
      font-size: 12px;
      color: #6b829d;
    }

    .options-grid {
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow-y: auto;
      overflow-x: hidden;
      flex: 1;
      min-height: 100px;
      max-height: calc(70vh - 80px);
      padding-right: 4px;
      -webkit-overflow-scrolling: touch;
    }

    .options-grid::-webkit-scrollbar {
      width: 6px;
    }

    .options-grid::-webkit-scrollbar-track {
      background: rgba(31, 42, 61, 0.3);
      border-radius: 3px;
    }

    .options-grid::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #22d3ee, #0ea5e9);
      border-radius: 3px;
      -webkit-transition: background 0.2s;
      transition: background 0.2s;
    }

    .options-grid::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg,
          rgb(81.3571428571, 220.4285714286, 241.6428571429),
          rgb(55.016194332, 184.6194331984, 242.983805668));
    }

    .options-grid {
      scrollbar-width: thin;
      scrollbar-color: #22d3ee rgba(31, 42, 61, 0.3);
    }

    .option-btn {
      background: linear-gradient(180deg, #111827 0%, #0d141d 100%);
      border: 1px solid #1f2a3d;
      padding: 14px 16px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: left;
      position: relative;
      overflow: hidden;
    }

    .option-btn::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg,
          transparent,
          rgba(34, 211, 238, 0.1),
          transparent);
      transform: translateX(-100%);
      transition: transform 0.5s ease;
    }

    .option-btn:hover::before {
      transform: translateX(100%);
    }

    .option-btn:hover {
      border-color: #22d3ee;
      box-shadow: 0 0 12px rgba(34, 211, 238, 0.3);
      transform: translateY(-2px);
    }

    .option-btn.leave-option {
      border-color: #6b829d;
      background: linear-gradient(180deg, #0f1722 0%, #0a0f14 100%);
    }

    .option-btn.leave-option:hover {
      border-color: #9db1c9;
      box-shadow: 0 0 8px rgba(157, 177, 201, 0.2);
    }

    .option-text {
      font-size: 14px;
      font-weight: 600;
      color: #e6f7ff;
      line-height: 1.5;
      word-break: break-word;
    }

    @media (max-width: 600px) {
      .options-root {
        width: 95vw;
        top: 5px;
        max-width: calc(100vw - 10px);
      }

      .options-panel {
        max-height: calc(85vh - 10px);
        padding: 12px;
      }

      .options-grid {
        gap: 8px;
        max-height: calc(75vh - 60px);
        min-height: 80px;
      }

      .option-btn {
        padding: 12px 14px;
      }

      .option-text {
        font-size: 13px;
      }
    }

    /*! tailwindcss v4.1.18 | MIT License | https://tailwindcss.com */
    .squad-selector-root {
      font-family: "Inter", "Noto Sans SC", sans-serif;
      position: fixed;
      inset: 0;
      background: linear-gradient(135deg, #0d1117 0%, #0b0f15 100%);
      color: #e6f7ff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 20px;
      padding-top: 40px;
      z-index: 9999;
      overflow-y: auto;
      max-height: 100vh;
    }

    .squad-selector-root::-webkit-scrollbar {
      width: 10px;
    }

    .squad-selector-root::-webkit-scrollbar-track {
      background: rgba(31, 42, 61, 0.3);
      border-radius: 5px;
    }

    .squad-selector-root::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #22d3ee, #0ea5e9);
      border-radius: 5px;
      -webkit-transition: background 0.2s;
      transition: background 0.2s;
    }

    .squad-selector-root::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg,
          rgb(81.3571428571, 220.4285714286, 241.6428571429),
          rgb(55.016194332, 184.6194331984, 242.983805668));
    }

    .squad-selector-root {
      scrollbar-width: thin;
      scrollbar-color: #22d3ee rgba(31, 42, 61, 0.3);
    }

    .squad-title-section {
      text-align: center;
      margin-bottom: 40px;
      max-width: 800px;
    }

    .squad-main-title {
      font-size: 48px;
      font-weight: 700;
      color: #22d3ee;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 2px;
      text-shadow: 0 0 20px rgba(34, 211, 238, 0.5);
    }

    .squad-subtitle {
      font-size: 18px;
      color: #9db1c9;
      font-weight: 400;
    }

    .squad-grid {
      display: flex;
      flex-direction: column;
      gap: 20px;
      max-width: 900px;
      width: 100%;
      margin-bottom: 40px;
      max-height: calc(100vh - 300px);
      overflow-y: auto;
      padding-right: 8px;
    }

    .squad-grid::-webkit-scrollbar {
      width: 8px;
    }

    .squad-grid::-webkit-scrollbar-track {
      background: rgba(31, 42, 61, 0.3);
      border-radius: 4px;
    }

    .squad-grid::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #22d3ee, #0ea5e9);
      border-radius: 4px;
      -webkit-transition: background 0.2s;
      transition: background 0.2s;
    }

    .squad-grid::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg,
          rgb(81.3571428571, 220.4285714286, 241.6428571429),
          rgb(55.016194332, 184.6194331984, 242.983805668));
    }

    .squad-grid {
      scrollbar-width: thin;
      scrollbar-color: #22d3ee rgba(31, 42, 61, 0.3);
    }

    .squad-card {
      background: rgba(17, 24, 33, 0.95);
      border: 2px solid #1f2a3d;
      border-radius: 8px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: visible;
      display: flex;
      flex-direction: column;
      min-height: 200px;
    }

    .squad-card.confirmed {
      cursor: default;
      opacity: 0.7;
    }

    .squad-card.confirmed:hover {
      transform: none;
      box-shadow: none;
      border-color: #1f2a3d;
    }

    .squad-card::before {
      content: "";
      position: absolute;
      inset: 0;
      border: 2px solid var(--squad-color, #22d3ee);
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
    }

    .squad-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.5);
      border-color: var(--squad-color, #22d3ee);
    }

    .squad-card:hover::before {
      opacity: 0.3;
    }

    .squad-card.selected {
      border-color: var(--squad-color, #22d3ee);
      box-shadow: 0 0 20px rgba(var(--squad-color-rgb, 34, 211, 238), 0.4);
    }

    .squad-card.selected::before {
      opacity: 0.5;
    }

    .squad-card-header {
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(31, 42, 61, 0.5);
    }

    .squad-card-name {
      font-size: 22px;
      font-weight: 700;
      color: var(--squad-color, #22d3ee);
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .squad-card-alias {
      font-size: 14px;
      color: #6b829d;
      font-style: italic;
    }

    .squad-card-body {
      margin-bottom: 16px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .squad-card-desc {
      font-size: 16px;
      color: #9db1c9;
      line-height: 1.6;
      flex: 1;
      overflow: visible;
      word-wrap: break-word;
    }

    .squad-card-footer {
      display: flex;
      justify-content: flex-end;
      margin-top: auto;
      flex-shrink: 0;
    }

    .squad-detail-btn {
      background: rgba(0, 0, 0, 0);
      border: 1px solid var(--squad-color, #22d3ee);
      color: var(--squad-color, #22d3ee);
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .squad-detail-btn:hover {
      background: var(--squad-color, #22d3ee);
      color: #0d1117;
      box-shadow: 0 0 12px rgba(var(--squad-color-rgb, 34, 211, 238), 0.4);
    }

    .squad-action-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      max-width: 600px;
      width: 100%;
    }

    .squad-confirm-btn {
      background: linear-gradient(90deg, #22d3ee, #0ea5e9);
      border: none;
      color: #0d1117;
      font-weight: 700;
      padding: 14px 32px;
      font-size: 16px;
      cursor: pointer;
      box-shadow: 0 0 20px rgba(34, 211, 238, 0.4);
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1px;
      width: 100%;
      max-width: 400px;
    }

    .squad-confirm-btn:hover {
      box-shadow: 0 0 30px rgba(34, 211, 238, 0.6);
      transform: translateY(-2px);
    }

    .squad-start-btn {
      background: linear-gradient(90deg, #10b981, #22d3ee);
      border: none;
      color: #0d1117;
      font-weight: 700;
      padding: 16px 40px;
      font-size: 18px;
      cursor: pointer;
      box-shadow: 0 0 24px rgba(16, 185, 129, 0.5);
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      width: 100%;
      max-width: 400px;
      position: relative;
      overflow: hidden;
    }

    .squad-start-btn::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent);
      transform: translateX(-100%);
      transition: transform 0.6s ease;
    }

    .squad-start-btn:hover {
      box-shadow: 0 0 40px rgba(16, 185, 129, 0.7);
      transform: translateY(-2px);
    }

    .squad-start-btn:hover::before {
      transform: translateX(100%);
    }

    .squad-dialog-mask {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.75);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
      backdrop-filter: blur(4px);
    }

    .squad-dialog {
      width: min(600px, 90vw);
      max-height: 80vh;
      background: rgba(17, 24, 33, 0.95);
      border: 2px solid var(--squad-color, #22d3ee);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6),
        0 0 20px rgba(var(--squad-color-rgb, 34, 211, 238), 0.3);
      padding: 24px;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      position: relative;
    }

    .squad-dialog::before {
      content: "";
      position: absolute;
      inset: 0;
      border: 2px solid rgba(var(--squad-color-rgb, 34, 211, 238), 0.3);
      pointer-events: none;
    }

    .squad-dialog::-webkit-scrollbar {
      width: 8px;
    }

    .squad-dialog::-webkit-scrollbar-track {
      background: rgba(31, 42, 61, 0.3);
      border-radius: 4px;
    }

    .squad-dialog::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #22d3ee, #0ea5e9);
      border-radius: 4px;
      -webkit-transition: background 0.2s;
      transition: background 0.2s;
    }

    .squad-dialog::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg,
          rgb(81.3571428571, 220.4285714286, 241.6428571429),
          rgb(55.016194332, 184.6194331984, 242.983805668));
    }

    .squad-dialog {
      scrollbar-width: thin;
      scrollbar-color: #22d3ee rgba(31, 42, 61, 0.3);
    }

    .squad-dialog-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(31, 42, 61, 0.5);
    }

    .squad-dialog-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--squad-color, #22d3ee);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .squad-dialog-alias {
      font-size: 16px;
      color: #6b829d;
      font-style: italic;
      margin-top: 4px;
    }

    .squad-dialog-close {
      background: rgba(0, 0, 0, 0);
      border: none;
      color: #9db1c9;
      font-size: 28px;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color 0.2s ease;
    }

    .squad-dialog-close:hover {
      color: #e6f7ff;
    }

    .squad-dialog-body {
      flex: 1;
      overflow-y: auto;
    }

    .squad-dialog-desc {
      font-size: 16px;
      color: #e6f7ff;
      line-height: 1.8;
      margin-bottom: 24px;
      padding: 16px;
      background: rgba(31, 42, 61, 0.3);
      border-left: 3px solid var(--squad-color, #22d3ee);
    }

    .squad-benefits-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--squad-color, #22d3ee);
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .squad-benefits-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .squad-benefit-item {
      font-size: 14px;
      color: #9db1c9;
      line-height: 1.6;
      padding: 12px;
      background: rgba(31, 42, 61, 0.2);
      border-left: 2px solid var(--squad-color, #22d3ee);
      padding-left: 16px;
    }

    .squad-dialog-actions {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 24px;
      padding-top: 20px;
      border-top: 1px solid rgba(31, 42, 61, 0.5);
    }

    .squad-dialog-cancel-btn {
      background: rgba(0, 0, 0, 0);
      border: 1px solid #1f2a3d;
      color: #e6f7ff;
      padding: 10px 20px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .squad-dialog-cancel-btn:hover {
      border-color: #9db1c9;
      background: rgba(157, 177, 201, 0.1);
    }

    .squad-dialog-confirm-btn {
      background: linear-gradient(90deg,
          var(--squad-color, #22d3ee),
          var(--squad-color, #0ea5e9));
      border: none;
      color: #0d1117;
      font-weight: 700;
      padding: 10px 24px;
      font-size: 14px;
      cursor: pointer;
      box-shadow: 0 0 16px rgba(var(--squad-color-rgb, 34, 211, 238), 0.4);
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .squad-dialog-confirm-btn:hover {
      box-shadow: 0 0 24px rgba(var(--squad-color-rgb, 34, 211, 238), 0.6);
      transform: translateY(-2px);
    }

    .squad-confirmed-badge {
      background: linear-gradient(90deg, #10b981, #22d3ee);
      color: #0d1117;
      padding: 6px 12px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-radius: 4px;
    }

    .squad-confirmed-info {
      text-align: center;
      padding: 16px;
      background: rgba(34, 211, 238, 0.1);
      border: 1px solid rgba(34, 211, 238, 0.3);
      border-radius: 6px;
      margin-bottom: 16px;
    }

    .squad-confirmed-label {
      font-size: 14px;
      color: #9db1c9;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .squad-confirmed-name {
      font-size: 20px;
      font-weight: 700;
      color: #22d3ee;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    @media (max-width: 768px) {
      .squad-selector-root {
        padding: 15px;
        padding-top: 30px;
      }

      .squad-main-title {
        font-size: 32px;
      }

      .squad-subtitle {
        font-size: 14px;
      }

      .squad-title-section {
        margin-bottom: 20px;
      }

      .squad-grid {
        grid-template-columns: 1fr;
        gap: 12px;
        max-height: calc(100vh - 250px);
        margin-bottom: 20px;
      }

      .squad-card {
        padding: 14px;
      }

      .squad-card-name {
        font-size: 18px;
      }

      .squad-card-desc {
        font-size: 15px;
        min-height: 50px;
      }

      .squad-dialog {
        width: 95vw;
        padding: 16px;
        max-height: 85vh;
      }

      .squad-action-section {
        width: 100%;
        padding: 0 10px;
      }

      .squad-start-btn {
        width: 100%;
        max-width: 100%;
      }
    }

    /*! tailwindcss v4.1.18 | MIT License | https://tailwindcss.com */
    .ark-root {
      font-family: "Inter", "Noto Sans SC", sans-serif;
      background: linear-gradient(135deg, #0d1117 0%, #0b0f15 100%);
      color: #e6f7ff;
      padding: 16px;
      padding-top: 120px;
      border: 1px solid #1f2a3d;
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.45);
      min-height: var(--TH-viewport-height);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .top-stack {
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 12px;
    }

    .panel,
    .progress-card,
    .route-map-panel {
      background: rgba(17, 24, 33, 0.9);
      border: 1px solid #1f2a3d;
      padding: 12px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.35);
      position: relative;
      overflow: hidden;
    }

    .panel.split-container {
      display: grid;
      grid-template-areas:
        "h h"
        "c i";
      column-gap: 12px;
      row-gap: 4px;
    }

    .panel-header.split-header {
      grid-area: h;
      margin-bottom: 0px;
    }

    .panel.split-collections {
      grid-area: c;
    }

    .panel.split-items {
      grid-area: i;
    }

    .panel.wide {
      grid-column: 1/-1;
    }

    .panel::after,
    .progress-card::after,
    .route-map-panel::after {
      content: "";
      position: absolute;
      inset: 0;
      border: 1px solid rgba(34, 211, 238, 0.12);
      pointer-events: none;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      gap: 10px;
    }

    .panel-title {
      font-size: 15px;
      font-weight: 700;
      color: #e6f7ff;
      letter-spacing: 0.6px;
      text-transform: uppercase;
    }

    .panel-sub {
      font-size: 12px;
      color: #6b829d;
    }

    .panel-actions {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 14px;
      letter-spacing: 0.5px;
      color: #22d3ee;
      text-transform: uppercase;
    }

    .info-row {
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }

    .squad-display {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
    }

    .squad-label {
      color: #9db1c9;
      font-weight: 600;
    }

    .squad-name {
      color: #a855f7;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .difficulty-display {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
    }

    .difficulty-label {
      color: #9db1c9;
      font-weight: 600;
    }

    .difficulty-name {
      color: #f59e0b;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .fetish-term-display {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
    }

    .fetish-term-label {
      color: #9db1c9;
      font-weight: 600;
    }

    .fetish-term-name {
      color: #22d3ee;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .hp-line {
      background: #0a0f14;
      border: 1px solid #1f2a3d;
      padding: 8px;
    }

    .hp-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: 600;
      color: #e6f7ff;
    }

    .hp-label .label {
      color: #0ea5e9;
    }

    .hp-bar {
      height: 10px;
      background: #1d2735;
      margin-top: 6px;
      position: relative;
      overflow: hidden;
    }

    .hp-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #0ea5e9, #22d3ee);
      box-shadow: 0 0 12px rgba(34, 211, 238, 0.4);
    }

    .resource-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 8px;
      margin-top: 10px;
    }

    .resource-pill {
      background: #111827;
      border: 1px solid #1f2a3d;
      padding: 6px 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      font-weight: 600;
    }

    .resource-pill.player-buff {
      flex-wrap: wrap;
      flex-direction: column;
    }

    .resource-pill.primary .pill-label {
      color: #ec4899;
    }

    .resource-pill.highlight .pill-label {
      color: #f59e0b;
    }

    .resource-pill.player-buff .pill-label {
      color: #55f7dc;
    }

    .resource-pill.player-buff .pill-desc {
      color: rgba(85, 247, 220, 0.5);
    }

    .resource-pill.ghost {
      background: rgba(0, 0, 0, 0);
      border-color: rgba(31, 42, 61, 0.5);
      color: #9db1c9;
    }

    .pill-label {
      color: #0ea5e9;
    }

    .pill-value {
      font-weight: 700;
    }

    .pill-desc {
      font-weight: 700;
    }

    .skills-grid,
    .items-grid,
    .collections-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 10px;
    }

    .item-card,
    .collection-card {
      background: #111827;
      border: 1px solid #1f2a3d;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .item-list-name {
      display: inline-flex;
      justify-content: space-between;
      font-weight: 700;
      color: #55f7dc;
      font-size: 14px;
    }

    .item-list-quantity {
      font-weight: 700;
      color: rgba(85, 247, 220, 0.5);
      font-size: 12px;
      text-align: right;
    }

    .collection-name {
      font-weight: 700;
      color: #a855f7;
      font-size: 14px;
    }

    .item-list-desc,
    .collection-desc {
      font-size: 12px;
      color: #9db1c9;
      line-height: 1.4;
    }

    .skill-btn {
      background: #111827;
      border: 1px solid #1f2a3d;
      padding: 10px;
      text-align: left;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      min-height: 80px;
    }

    .skill-btn:hover:not(.disabled) {
      border-color: #22d3ee;
      box-shadow: 0 0 8px rgba(34, 211, 238, 0.3);
      transform: translateY(-2px);
    }

    .skill-btn.disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .skill-name {
      font-weight: 700;
      color: #22d3ee;
      font-size: 14px;
      margin-bottom: 4px;
    }

    .skill-desc {
      font-size: 12px;
      color: #9db1c9;
      line-height: 1.4;
      flex-grow: 1;
    }

    .skill-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
      font-size: 12px;
      color: #9db1c9;
    }

    .cd-tag {
      color: #f59e0b;
    }

    .ready-tag {
      color: #22d3ee;
    }

    .character-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 10px;
    }

    .char-card {
      background: #0f1722;
      border: 1px solid #1f2a3d;
      padding: 10px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .char-card:hover {
      border-color: #22d3ee;
      box-shadow: 0 0 8px rgba(34, 211, 238, 0.3);
    }

    .char-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .char-header .name {
      font-weight: 700;
      color: #e6f7ff;
    }

    .dialog-title .trigger-word,
    .char-header .trigger-word {
      color: rgba(34, 211, 238, 0.8);
      font-size: 12px;
      margin-left: 4px;
    }

    .dialog-title .promoted-tattoo {
      color: #a855f7;
      font-size: 12px;
      margin-left: 4px;
    }

    .badge {
      padding: 4px 8px;
      border: 1px solid #22d3ee;
      color: #22d3ee;
      font-size: 12px;
      text-transform: uppercase;
      white-space: nowrap;
    }

    .badge.hostile {
      border-color: #f97316;
      color: #f97316;
    }

    .badge.corrupted {
      border-color: #ec4899;
      color: #ec4899;
    }

    .badge.promoted {
      border-color: #a855f7;
      color: #a855f7;
    }

    .badge.neutral {
      border-color: #9db1c9;
      color: #9db1c9;
    }

    .badge.race {
      border-color: #abfaa8;
      color: #abfaa8;
    }

    .badge.items {
      border-color: #55f7dc;
      color: #55f7dc;
    }

    .badge.collections {
      border-color: #a855f7;
      color: #a855f7;
    }

    .clothing-line {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: #9db1c9;
      margin-bottom: 6px;
    }

    .clothing-line .label {
      font-weight: 600;
    }

    .clothing-line .value {
      color: #e6f7ff;
    }

    .stat-line {
      display: grid;
      grid-template-columns: 60px 1fr 60px;
      align-items: center;
      gap: 6px;
      font-size: 12px;
    }

    .stat-line .label {
      color: #9db1c9;
    }

    .stat-line .bar {
      background: #1d2735;
      height: 8px;
      position: relative;
    }

    .stat-line .bar .fill {
      height: 100%;
      background: linear-gradient(90deg, #f97316, #f59e0b);
    }

    .stat-line .bar .fill.orange {
      background: linear-gradient(90deg, #f97316, #ef4444);
    }

    .stat-line .value {
      text-align: right;
      color: #e6f7ff;
    }

    .shop-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
    }

    .shop-card {
      background: linear-gradient(180deg, #0f1722 0%, #0d141d 100%);
      border: 1px solid #1f2a3d;
      padding: 10px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
    }

    .shop-card:hover {
      border-color: #22d3ee;
      box-shadow: 0 0 12px rgba(34, 211, 238, 0.3);
    }

    .shop-card.disabled {
      opacity: 0.35;
      cursor: not-allowed;
    }

    .card-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .item-name {
      font-weight: 700;
      color: #e6f7ff;
    }

    .tag {
      font-size: 12px;
      padding: 2px 6px;
      border: 1px solid #22d3ee;
      color: #22d3ee;
    }

    .price-line {
      display: flex;
      justify-content: space-between;
      color: #f97316;
      font-weight: 700;
      margin-bottom: 6px;
    }

    .desc {
      color: #9db1c9;
      font-size: 12px;
      line-height: 1.5;
    }

    .ghost-btn {
      background: rgba(0, 0, 0, 0);
      border: 1px dashed #334155;
      color: #e6f7ff;
      padding: 6px 10px;
      cursor: pointer;
      transition: border-color 0.2s ease;
    }

    .ghost-btn:hover {
      border-color: #22d3ee;
    }

    .dialog-mask {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.55);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2000;
    }

    .dialog {
      width: min(420px, 92vw);
      background: #0f1722;
      border: 1px solid #1f2a3d;
      box-shadow: 0 16px 32px rgba(0, 0, 0, 0.45);
      padding: 14px;
      display: flex;
      flex-direction: column;
    }

    .dialog-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      /* margin-bottom: 10px; */
      padding-bottom: 10px;
      gap: 10px;
      border-bottom: 1px solid rgba(203, 213, 230, 0.5);
    }

    .dialog-header-content {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      flex-grow: 1;
      min-width: 0;
    }

    .dialog-title {
      font-size: 16px;
      font-weight: 700;
      color: #e6f7ff;
      word-break: break-word;
    }

    .dialog-sub {
      display: flex;
      justify-content: flex-start;
      align-content: center;
      flex-wrap: wrap;
      gap: 4px;
      color: #0ea5e9;
      font-size: 12px;
      /* margin-top: 4px; */
    }

    .char-header .dialog-sub,
    .dialog-header .dialog-sub {
      justify-content: flex-end;
    }

    .close {
      background: rgba(0, 0, 0, 0);
      border: none;
      color: #9db1c9;
      font-size: 20px;
      cursor: pointer;
      flex-shrink: 0;
    }

    .dialog-body {
      /* margin: 10px 0; */
      color: #e6f7ff;
      line-height: 1.6;
      flex-grow: 1;
      overflow-y: auto;
    }

    .dialog-price span {
      color: #f97316;
      font-weight: 700;
    }

    .dialog-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      margin-top: 10px;
    }

    .confirm-btn {
      background: linear-gradient(90deg, #22d3ee, #0ea5e9);
      border: none;
      color: #0d1117;
      font-weight: 700;
      padding: 8px 12px;
      cursor: pointer;
      box-shadow: 0 0 12px rgba(34, 211, 238, 0.35);
      transition: all 0.2s ease;
    }

    .confirm-btn:hover:not(:disabled) {
      box-shadow: 0 0 16px rgba(34, 211, 238, 0.5);
      transform: translateY(-1px);
    }

    .confirm-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      box-shadow: none;
    }

    .empty {
      color: #6b829d;
      font-size: 13px;
    }

    .loading {
      color: #e6f7ff;
      padding: 16px;
    }

    .character-dialog {
      width: min(480px, 92vw);
    }

    .character-detail-section {
      display: flex;
      flex-direction: column;
      /* gap: 10px; */
    }

    .detail-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      padding: 6px 0;
      border-bottom: 1px dashed rgba(31, 42, 61, 0.5);
    }

    .detail-item:last-of-type {
      border-bottom: none;
    }

    .detail-item.full-width {
      flex-direction: column;
      align-items: flex-start;
      gap: 4px;
      padding: 8px 0;
    }

    .detail-item.complexed {
      flex-direction: row;
      flex-wrap: wrap;
      align-items: center;
      justify-content: flex-start;
      gap: 4px;
      padding: 8px 0;
    }

    .detail-label {
      color: #9db1c9;
      font-weight: 600;
      min-width: 60px;
      flex-shrink: 0;
    }

    .detail-label.leftup {
      color: #9db1c9;
      align-self: flex-start;
      font-weight: 600;
      min-width: 60px;
      flex-shrink: 0;
    }

    .detail-value {
      color: #e6f7ff;
      text-align: right;
      flex-grow: 1;
      word-break: break-word;
    }

    .detail-bar-container {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-grow: 1;
    }

    .detail-bar {
      flex-grow: 1;
      height: 8px;
      background: #1d2735;
      position: relative;
      overflow: hidden;
    }

    .detail-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #f97316, #ef4444);
    }

    .detail-bar-fill.blue {
      background: linear-gradient(90deg, #0ea5e9, #22d3ee);
    }

    .detail-bar-value {
      color: #e6f7ff;
      font-size: 12px;
      min-width: 40px;
      text-align: right;
    }

    .character-status-text {
      display: flex;
      color: #e6f7ff;
      font-size: 13px;
      line-height: 1.5;
      margin-top: 4px;
      padding: 6px 12px;
      background: rgba(29, 39, 53, 0.5);
      border-left: 2px solid #22d3ee;
      word-break: break-word;
      /* min-height: 60px; */
      white-space: pre-wrap;
    }

    .promotion-section {
      background: rgba(236, 72, 153, 0.1);
      border: 1px solid rgba(236, 72, 153, 0.3);
      padding: 10px;
      margin-top: 10px;
      border-radius: 4px;
    }

    .promotion-info {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .promotion-label {
      font-size: 14px;
      font-weight: 700;
      color: #ec4899;
    }

    .promotion-cost,
    .promotion-tip {
      font-size: 12px;
      color: #9db1c9;
    }

    .node-dialog {
      width: min(600px, 92vw);
    }

    .node-data-content {
      max-height: 400px;
      overflow-y: auto;
    }

    .combat-info {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .combat-info-item {
      display: flex;
      gap: 8px;
      padding: 8px;
      background: rgba(31, 42, 61, 0.5);
      border-left: 2px solid #22d3ee;
    }

    .combat-label {
      color: #9db1c9;
      font-weight: 700;
      min-width: 100px;
      flex-shrink: 0;
    }

    .combat-value {
      color: #e6f7ff;
      flex: 1;
      word-break: break-word;
    }

    .combat-description {
      padding: 10px;
      background: rgba(14, 165, 233, 0.15);
      border: 1px solid rgba(14, 165, 233, 0.4);
      margin-bottom: 10px;
      border-radius: 4px;
    }

    .description-label {
      font-weight: 700;
      color: #0ea5e9;
      margin-bottom: 4px;
    }

    .description-content {
      color: #e6f7ff;
      line-height: 1.5;
      word-break: break-word;
    }

    .combat-info-empty {
      color: #6b829d;
      text-align: center;
      padding: 20px;
    }

    .node-type-info {
      padding: 16px;
      background: rgba(31, 42, 61, 0.5);
      border-left: 3px solid #22d3ee;
    }

    .type-label {
      color: #9db1c9;
      font-size: 12px;
      font-weight: 700;
      margin-bottom: 8px;
      text-transform: uppercase;
    }

    .type-value {
      color: #e6f7ff;
      font-size: 16px;
      font-weight: 600;
    }

    .route-map-panel {
      margin-bottom: 12px;
    }

    .route-map-container {
      overflow-x: auto;
      padding: 12px 0;
      margin-top: 8px;
    }

    .route-map-container::-webkit-scrollbar {
      height: 8px;
    }

    .route-map-container::-webkit-scrollbar-track {
      background: rgba(31, 42, 61, 0.3);
      border-radius: 4px;
    }

    .route-map-container::-webkit-scrollbar-thumb {
      background: linear-gradient(90deg, #22d3ee, #0ea5e9);
      border-radius: 4px;
      -webkit-transition: background 0.2s;
      transition: background 0.2s;
    }

    .route-map-container::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(90deg,
          rgb(81.3571428571, 220.4285714286, 241.6428571429),
          rgb(55.016194332, 184.6194331984, 242.983805668));
    }

    .route-map-container {
      scrollbar-width: thin;
      scrollbar-color: #22d3ee rgba(31, 42, 61, 0.3);
    }

    .route-map {
      display: flex;
      align-items: center;
      min-width: -moz-fit-content;
      min-width: fit-content;
      justify-content: center;
      gap: 8px;
    }

    .route-node-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      position: relative;
    }

    .route-node-wrapper {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .route-node {
      width: 70px;
      height: 70px;
      background: #111827;
      border: 1px solid #1f2a3d;
      border-radius: 4px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      text-align: center;
      font-size: 10px;
      transition: all 0.2s ease;
      position: relative;
      z-index: 5;
    }

    .route-node.clickable {
      cursor: pointer;
      border-color: #22d3ee;
      box-shadow: 0 0 8px rgba(34, 211, 238, 0.3);
    }

    .route-node.clickable:hover {
      transform: scale(1.05);
      box-shadow: 0 0 12px rgba(34, 211, 238, 0.5);
    }

    .route-node.completed {
      opacity: 0.5;
    }

    .route-node.current-node {
      border-color: #22d3ee;
      background: rgba(34, 211, 238, 0.2);
      box-shadow: 0 0 16px rgba(34, 211, 238, 0.4);
      transform: scale(1.1);
      z-index: 10;
    }

    .node-number {
      font-size: 12px;
      font-weight: 700;
      color: #22d3ee;
      margin-bottom: 4px;
    }

    .node-type {
      font-size: 11px;
      color: #e6f7ff;
      line-height: 1.2;
    }

    .current-marker {
      position: absolute;
      top: -8px;
      left: 50%;
      transform: translateX(-50%);
      background: #22d3ee;
      color: #0d1117;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 2px;
      white-space: nowrap;
      font-weight: 700;
    }

    .route-connector {
      width: 20px;
      height: 2px;
      background: #1f2a3d;
      position: relative;
      flex-shrink: 0;
    }

    .route-connector::after {
      content: "";
      position: absolute;
      right: 0;
      top: 50%;
      transform: translateY(-50%) rotate(45deg);
      width: 8px;
      height: 8px;
      border-top: 2px solid #1f2a3d;
      border-right: 2px solid #1f2a3d;
    }

    .option-connector {
      width: 2px;
      height: 10px;
      background: #1f2a3d;
      position: absolute;
      bottom: -10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1;
    }

    .route-node-wrapper.has-options:not(:last-child) .route-node {
      margin-bottom: 10px;
    }

    .option-number {
      position: absolute;
      top: -4px;
      left: -4px;
      background: #0ea5e9;
      color: #e6f7ff;
      font-size: 9px;
      padding: 1px 4px;
      border-radius: 2px;
      font-weight: 700;
      z-index: 15;
    }

    .route-node.combat {
      border-color: #f97316;
    }

    .route-node.combat .node-number {
      color: #f97316;
    }

    .route-node.urgent-combat {
      border-color: #ef4444;
    }

    .route-node.urgent-combat .node-number {
      color: #ef4444;
    }

    .route-node.boss {
      border-color: #ef4444;
      box-shadow: 0 0 16px rgba(239, 68, 68, 0.6);
      animation: boss-glow 1.5s infinite alternate;
    }

    .route-node.boss .node-number {
      color: #ef4444;
    }

    @keyframes boss-glow {
      from {
        box-shadow: 0 0 16px rgba(239, 68, 68, 0.6);
      }

      to {
        box-shadow: 0 0 24px rgba(239, 68, 68, 0.9);
      }
    }

    .route-node.event {
      border-color: #a855f7;
    }

    .route-node.event .node-number {
      color: #a855f7;
    }

    .route-node.shop {
      border-color: #f59e0b;
    }

    .route-node.shop .node-number {
      color: #f59e0b;
    }

    .route-node.safehouse {
      border-color: #10b981;
    }

    .route-node.safehouse .node-number {
      color: #10b981;
    }

    .route-node.leisure {
      border-color: #22d3ee;
    }

    .route-node.leisure .node-number {
      color: #22d3ee;
    }

    .route-node.reward {
      border-color: #ec4899;
    }

    .route-node.reward .node-number {
      color: #ec4899;
    }

    .route-node.unknown {
      border-color: #6b829d;
    }

    .route-node.unknown .node-number {
      color: #6b829d;
    }

    @media (max-width: 900px) {
      .top-stack {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 600px) {
      .ark-root {
        padding: 8px;
        padding-top: 100px;
      }

      .panel,
      .progress-card,
      .route-map-panel {
        padding: 8px;
      }

      .panel.split-container {
        grid-template-areas:
          "h"
          "c"
          "i";
        row-gap: 4px;
      }

      .resource-grid {
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      }

      .skills-grid,
      .items-grid,
      .collections-grid {
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      }

      .character-grid {
        grid-template-columns: 1fr;
      }

      .shop-grid {
        grid-template-columns: 1fr;
      }

      .dialog {
        width: 95vw;
      }

      .route-node {
        width: 60px;
        height: 60px;
      }

      .node-number {
        font-size: 11px;
      }

      .node-type {
        font-size: 10px;
      }
    }

    /*# sourceMappingURL=main.css.map*/
  </style>
</head>
<body>
  <div id="squad-selector"></div>
  <div id="difficulty-selector"></div>
  <div id="options-app"></div>
  <div id="status-app"></div>
</body>
